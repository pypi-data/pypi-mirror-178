[compat]
build =
	%if 0%{{?py3_build:1}}
	%py3_build
	%else
	%{{__python3}} setup.py build
	%endif

install =
	%if 0%{{?py3_install:1}}
	%py3_install
	%else
	%{{__python3}} setup.py install --single-version-externally-managed --skip-build -O1 --root=%{{buildroot}} --prefix %{{_prefix}}
	%endif

	echo %{{python3_sitelib}}/{name} > INSTALLED_FILES
	echo %{{python3_sitelib}}/{name}-{version}-py%{{python3_version}}.egg-info >> INSTALLED_FILES

	for f in {disabled-entry-points}; do rm -f "%{{buildroot}}%{{_bindir}}/$$f"; done

	# Best effort to catch data files. Works if their names (or a parent directoryâ€™s name) start with the python module name
	find "%{{buildroot}}%{{_prefix}}" -wholename "%{{buildroot}}%{{python3_sitelib}}" -prune -o -name '{name}*' -printf '%{{_prefix}}/%%P\n' -prune >> INSTALLED_FILES
	for f in {entry-points}; do chmod 0755 "%{{buildroot}}%{{_bindir}}/$$f"; echo "%{{_bindir}}/$$f"; done | grep -vxFf INSTALLED_FILES >> INSTALLED_FILES

	%find_lang {name} && cat {name}.lang >> INSTALLED_FILES || :
