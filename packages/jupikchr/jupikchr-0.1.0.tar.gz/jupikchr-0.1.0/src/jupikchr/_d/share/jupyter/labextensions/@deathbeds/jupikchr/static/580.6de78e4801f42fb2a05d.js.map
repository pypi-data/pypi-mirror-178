{"version":3,"file":"580.6de78e4801f42fb2a05d.js?v=6de78e4801f42fb2a05d","mappings":"8MAWA,IAAIA,EAA6C,KAE1CC,eAAeC,IACpB,GAAIF,EACF,OAAOA,EAAaG,QAEtBH,EAAe,IAAI,EAAAI,sBACb,eACNJ,EAAaK,aAAQ,EACvB,CAOO,SAASC,EAAOC,EAAiBC,EAAoB,CAAC,GAC3D,IAAI,KAAEC,EAAI,IAAEC,GAAQF,EACR,MAARC,IACFA,EAA8C,UAAvCE,SAASC,KAAKC,QAAQC,cAE/B,MAAMC,EAAQN,EAAO,KAAmB,EAExC,IAAIO,EAAS,WAAkBT,EAAQU,OAAQ,SAAUF,GAEzD,GAAIC,EAAOE,SAAS,QAElB,OAAQV,EAAQE,KACd,UAAKS,EACL,KAAK,KACL,IAAK,MACHH,EAAS,GAAGI,IAASJ,IACrB,MAAMK,EAAaC,iBAAiBX,SAASC,MAAMW,iBACjD,MAGFP,EAASA,EAAOQ,QACd,SACA,8BAA8BH,sBAEhC,MAAMI,EAAUT,EAAOU,MAAM,MACvBC,EAAS,GACf,IAAIC,EAAa,GACF,MAAXH,IACFE,EAAOE,KAAK,aAAaJ,EAAQ,OAAQ,cAAcA,EAAQ,QAC/DG,EAAa,WAAWH,EAAQ,eAAeA,EAAQ,OAGzDT,EAAS,qDAEDY,2BACOD,EAAOG,KAAK,gDACQC,mBAAmBf,sBAEtD,MACF,IAAK,MACH,MACF,QACEA,EAAS,yBAAyBN,WAGxC,OAAOM,CACT,CAGA,MAgQMI,EAAS,8IAhQO,66MA8PpBI,QAAQ,MAAO,W","sources":["webpack://@deathbeds/jupikchr/./src/render.ts"],"sourcesContent":["import {\n  JP_UI_FONT_FAMILY,\n  RE_VIEWBOX,\n  PIKCHR_DARK_MODE,\n  TPikchrFormat,\n} from './tokens';\n\nimport { PromiseDelegate } from '@lumino/coreutils';\n\nimport pikchrWasm from 'pikchr-wasm';\n\nlet initializing: PromiseDelegate<void> | null = null;\n\nexport async function initialize(): Promise<void> {\n  if (initializing) {\n    return initializing.promise;\n  }\n  initializing = new PromiseDelegate();\n  await pikchrWasm.loadWASM();\n  initializing.resolve(void 0);\n}\n\nexport interface IOptions {\n  tag?: TPikchrFormat;\n  dark?: boolean;\n}\n\nexport function render(content: string, options: IOptions = {}): string {\n  let { dark, tag } = options;\n  if (dark == null) {\n    dark = document.body.dataset.jpThemeLight === 'false';\n  }\n  const flags = dark ? PIKCHR_DARK_MODE : 0;\n\n  let result = pikchrWasm.render(content.trim(), 'pikchr', flags);\n\n  if (result.includes('<svg')) {\n    // sanitize\n    switch (options.tag) {\n      case undefined:\n      case null:\n      case 'img':\n        result = `${HEADER}${result}`;\n        const fontFamily = getComputedStyle(document.body).getPropertyValue(\n          JP_UI_FONT_FAMILY\n        );\n        // defaults to serif, re-use the current lab stack\n        result = result.replace(\n          '</svg>',\n          `<style>text { font-family: ${fontFamily}; }</style></svg>`\n        );\n        const viewBox = result.match(RE_VIEWBOX);\n        const styles = [];\n        let dimensions = '';\n        if (viewBox != null) {\n          styles.push(`max-width:${viewBox[3]}px`, `max-height:${viewBox[4]}px`);\n          dimensions = `height=\"${viewBox[3]}\" height=\"${viewBox[4]}\"`;\n        }\n        // markdown-it strips svg\n        result = `<img\n              class=\"pikchr\"\n              ${dimensions}\n              style=\"${styles.join(';')}\"\n              src=\"${`data:image/svg+xml,${encodeURIComponent(result)}`}\"\n            />`;\n        break;\n      case 'svg':\n        break;\n      default:\n        result = `<pre>Can't render as <${tag}></pre>`;\n    }\n  }\n  return result;\n}\n\n// TODO: find a better source of these\nconst HTML_ENTITIES = `\n<!ENTITY quot \"&#34;\">\n<!ENTITY Aacute \"&#193;\">\n<!ENTITY aacute \"&#225;\">\n<!ENTITY Acirc \"&#194;\">\n<!ENTITY acirc \"&#226;\">\n<!ENTITY acute \"&#180;\">\n<!ENTITY AElig \"&#198;\">\n<!ENTITY aelig \"&#230;\">\n<!ENTITY Agrave \"&#192;\">\n<!ENTITY agrave \"&#224;\">\n<!ENTITY alefsym \"&#8501;\">\n<!ENTITY Alpha \"&#913;\">\n<!ENTITY alpha \"&#945;\">\n<!ENTITY amp \"&#38;\">\n<!ENTITY and \"&#8743;\">\n<!ENTITY ang \"&#8736;\">\n<!ENTITY apos \"&#39;\">\n<!ENTITY Aring \"&#197;\">\n<!ENTITY aring \"&#229;\">\n<!ENTITY asymp \"&#8776;\">\n<!ENTITY Atilde \"&#195;\">\n<!ENTITY atilde \"&#227;\">\n<!ENTITY Auml \"&#196;\">\n<!ENTITY auml \"&#228;\">\n<!ENTITY bdquo \"&#8222;\">\n<!ENTITY Beta \"&#914;\">\n<!ENTITY beta \"&#946;\">\n<!ENTITY brvbar \"&#166;\">\n<!ENTITY bull \"&#8226;\">\n<!ENTITY cap \"&#8745;\">\n<!ENTITY Ccedil \"&#199;\">\n<!ENTITY ccedil \"&#231;\">\n<!ENTITY cedil \"&#184;\">\n<!ENTITY cent \"&#162;\">\n<!ENTITY Chi \"&#935;\">\n<!ENTITY chi \"&#967;\">\n<!ENTITY circ \"&#710;\">\n<!ENTITY clubs \"&#9827;\">\n<!ENTITY cong \"&#8773;\">\n<!ENTITY copy \"&#169;\">\n<!ENTITY crarr \"&#8629;\">\n<!ENTITY cup \"&#8746;\">\n<!ENTITY curren \"&#164;\">\n<!ENTITY dagger \"&#8224;\">\n<!ENTITY Dagger \"&#8225;\">\n<!ENTITY darr \"&#8595;\">\n<!ENTITY dArr \"&#8659;\">\n<!ENTITY deg \"&#176;\">\n<!ENTITY Delta \"&#916;\">\n<!ENTITY delta \"&#948;\">\n<!ENTITY diams \"&#9830;\">\n<!ENTITY divide \"&#247;\">\n<!ENTITY Eacute \"&#201;\">\n<!ENTITY eacute \"&#233;\">\n<!ENTITY Ecirc \"&#202;\">\n<!ENTITY ecirc \"&#234;\">\n<!ENTITY Egrave \"&#200;\">\n<!ENTITY egrave \"&#232;\">\n<!ENTITY empty \"&#8709;\">\n<!ENTITY emsp \"&#8195;\">\n<!ENTITY ensp \"&#8194;\">\n<!ENTITY Epsilon \"&#917;\">\n<!ENTITY epsilon \"&#949;\">\n<!ENTITY equiv \"&#8801;\">\n<!ENTITY Eta \"&#919;\">\n<!ENTITY eta \"&#951;\">\n<!ENTITY ETH \"&#208;\">\n<!ENTITY eth \"&#240;\">\n<!ENTITY Euml \"&#203;\">\n<!ENTITY euml \"&#235;\">\n<!ENTITY euro \"&#8364;\">\n<!ENTITY exist \"&#8707;\">\n<!ENTITY fnof \"&#402;\">\n<!ENTITY forall \"&#8704;\">\n<!ENTITY frac12 \"&#189;\">\n<!ENTITY frac14 \"&#188;\">\n<!ENTITY frac34 \"&#190;\">\n<!ENTITY frasl \"&#8260;\">\n<!ENTITY Gamma \"&#915;\">\n<!ENTITY gamma \"&#947;\">\n<!ENTITY ge \"&#8805;\">\n<!ENTITY gt \"&#62;\">\n<!ENTITY harr \"&#8596;\">\n<!ENTITY hArr \"&#8660;\">\n<!ENTITY hearts \"&#9829;\">\n<!ENTITY hellip \"&#8230;\">\n<!ENTITY Iacute \"&#205;\">\n<!ENTITY iacute \"&#237;\">\n<!ENTITY Icirc \"&#206;\">\n<!ENTITY icirc \"&#238;\">\n<!ENTITY iexcl \"&#161;\">\n<!ENTITY Igrave \"&#204;\">\n<!ENTITY igrave \"&#236;\">\n<!ENTITY image \"&#8465;\">\n<!ENTITY infin \"&#8734;\">\n<!ENTITY int \"&#8747;\">\n<!ENTITY Iota \"&#921;\">\n<!ENTITY iota \"&#953;\">\n<!ENTITY iquest \"&#191;\">\n<!ENTITY isin \"&#8712;\">\n<!ENTITY Iuml \"&#207;\">\n<!ENTITY iuml \"&#239;\">\n<!ENTITY Kappa \"&#922;\">\n<!ENTITY kappa \"&#954;\">\n<!ENTITY Lambda \"&#923;\">\n<!ENTITY lambda \"&#955;\">\n<!ENTITY lang \"&#9001;\">\n<!ENTITY laquo \"&#171;\">\n<!ENTITY larr \"&#8592;\">\n<!ENTITY lArr \"&#8656;\">\n<!ENTITY lceil \"&#8968;\">\n<!ENTITY ldquo \"&#8220;\">\n<!ENTITY le \"&#8804;\">\n<!ENTITY lfloor \"&#8970;\">\n<!ENTITY lowast \"&#8727;\">\n<!ENTITY loz \"&#9674;\">\n<!ENTITY lrm \"&#8206;\">\n<!ENTITY lsaquo \"&#8249;\">\n<!ENTITY lsquo \"&#8216;\">\n<!ENTITY lt \"&#60;\">\n<!ENTITY macr \"&#175;\">\n<!ENTITY mdash \"&#8212;\">\n<!ENTITY micro \"&#181;\">\n<!ENTITY middot \"&#183;\">\n<!ENTITY minus \"&#8722;\">\n<!ENTITY Mu \"&#924;\">\n<!ENTITY mu \"&#956;\">\n<!ENTITY nabla \"&#8711;\">\n<!ENTITY nbsp \"&#160;\">\n<!ENTITY ndash \"&#8211;\">\n<!ENTITY ne \"&#8800;\">\n<!ENTITY ni \"&#8715;\">\n<!ENTITY not \"&#172;\">\n<!ENTITY notin \"&#8713;\">\n<!ENTITY nsub \"&#8836;\">\n<!ENTITY Ntilde \"&#209;\">\n<!ENTITY ntilde \"&#241;\">\n<!ENTITY Nu \"&#925;\">\n<!ENTITY nu \"&#957;\">\n<!ENTITY Oacute \"&#211;\">\n<!ENTITY oacute \"&#243;\">\n<!ENTITY Ocirc \"&#212;\">\n<!ENTITY ocirc \"&#244;\">\n<!ENTITY OElig \"&#338;\">\n<!ENTITY oelig \"&#339;\">\n<!ENTITY Ograve \"&#210;\">\n<!ENTITY ograve \"&#242;\">\n<!ENTITY oline \"&#8254;\">\n<!ENTITY Omega \"&#937;\">\n<!ENTITY omega \"&#969;\">\n<!ENTITY Omicron \"&#927;\">\n<!ENTITY omicron \"&#959;\">\n<!ENTITY oplus \"&#8853;\">\n<!ENTITY or \"&#8744;\">\n<!ENTITY ordf \"&#170;\">\n<!ENTITY ordm \"&#186;\">\n<!ENTITY Oslash \"&#216;\">\n<!ENTITY oslash \"&#248;\">\n<!ENTITY Otilde \"&#213;\">\n<!ENTITY otilde \"&#245;\">\n<!ENTITY otimes \"&#8855;\">\n<!ENTITY Ouml \"&#214;\">\n<!ENTITY ouml \"&#246;\">\n<!ENTITY para \"&#182;\">\n<!ENTITY part \"&#8706;\">\n<!ENTITY permil \"&#8240;\">\n<!ENTITY perp \"&#8869;\">\n<!ENTITY Phi \"&#934;\">\n<!ENTITY phi \"&#966;\">\n<!ENTITY Pi \"&#928;\">\n<!ENTITY pi \"&#960;\">\n<!ENTITY piv \"&#982;\">\n<!ENTITY plusmn \"&#177;\">\n<!ENTITY pound \"&#163;\">\n<!ENTITY prime \"&#8242;\">\n<!ENTITY Prime \"&#8243;\">\n<!ENTITY prod \"&#8719;\">\n<!ENTITY prop \"&#8733;\">\n<!ENTITY Psi \"&#936;\">\n<!ENTITY psi \"&#968;\">\n<!ENTITY radic \"&#8730;\">\n<!ENTITY rang \"&#9002;\">\n<!ENTITY raquo \"&#187;\">\n<!ENTITY rarr \"&#8594;\">\n<!ENTITY rArr \"&#8658;\">\n<!ENTITY rceil \"&#8969;\">\n<!ENTITY rdquo \"&#8221;\">\n<!ENTITY real \"&#8476;\">\n<!ENTITY reg \"&#174;\">\n<!ENTITY rfloor \"&#8971;\">\n<!ENTITY Rho \"&#929;\">\n<!ENTITY rho \"&#961;\">\n<!ENTITY rlm \"&#8207;\">\n<!ENTITY rsaquo \"&#8250;\">\n<!ENTITY rsquo \"&#8217;\">\n<!ENTITY sbquo \"&#8218;\">\n<!ENTITY Scaron \"&#352;\">\n<!ENTITY scaron \"&#353;\">\n<!ENTITY sdot \"&#8901;\">\n<!ENTITY sect \"&#167;\">\n<!ENTITY shy \"&#173;\">\n<!ENTITY Sigma \"&#931;\">\n<!ENTITY sigma \"&#963;\">\n<!ENTITY sigmaf \"&#962;\">\n<!ENTITY sim \"&#8764;\">\n<!ENTITY spades \"&#9824;\">\n<!ENTITY sub \"&#8834;\">\n<!ENTITY sube \"&#8838;\">\n<!ENTITY sum \"&#8721;\">\n<!ENTITY sup \"&#8835;\">\n<!ENTITY sup1 \"&#185;\">\n<!ENTITY sup2 \"&#178;\">\n<!ENTITY sup3 \"&#179;\">\n<!ENTITY supe \"&#8839;\">\n<!ENTITY szlig \"&#223;\">\n<!ENTITY Tau \"&#932;\">\n<!ENTITY tau \"&#964;\">\n<!ENTITY there4 \"&#8756;\">\n<!ENTITY Theta \"&#920;\">\n<!ENTITY theta \"&#952;\">\n<!ENTITY thetasym \"&#977;\">\n<!ENTITY thinsp \"&#8201;\">\n<!ENTITY THORN \"&#222;\">\n<!ENTITY thorn \"&#254;\">\n<!ENTITY tilde \"&#732;\">\n<!ENTITY times \"&#215;\">\n<!ENTITY trade \"&#8482;\">\n<!ENTITY Uacute \"&#218;\">\n<!ENTITY uacute \"&#250;\">\n<!ENTITY uarr \"&#8593;\">\n<!ENTITY uArr \"&#8657;\">\n<!ENTITY Ucirc \"&#219;\">\n<!ENTITY ucirc \"&#251;\">\n<!ENTITY Ugrave \"&#217;\">\n<!ENTITY ugrave \"&#249;\">\n<!ENTITY uml \"&#168;\">\n<!ENTITY upsih \"&#978;\">\n<!ENTITY Upsilon \"&#933;\">\n<!ENTITY upsilon \"&#965;\">\n<!ENTITY Uuml \"&#220;\">\n<!ENTITY uuml \"&#252;\">\n<!ENTITY weierp \"&#8472;\">\n<!ENTITY Xi \"&#926;\">\n<!ENTITY xi \"&#958;\">\n<!ENTITY Yacute \"&#221;\">\n<!ENTITY yacute \"&#253;\">\n<!ENTITY yen \"&#165;\">\n<!ENTITY yuml \"&#255;\">\n<!ENTITY Yuml \"&#376;\">\n<!ENTITY Zeta \"&#918;\">\n<!ENTITY zeta \"&#950;\">\n<!ENTITY zwj \"&#8205;\">\n<!ENTITY zwnj \"&#8204;\">\n`.replace(/\\n/g, ' ');\n\nconst HEADER = `<?xml version=\"1.0\" standalone=\"no\"?>\n<!DOCTYPE svg PUBLIC \"-//W3C//DTD SVG 1.1//EN\" \"http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd\" [ ${HTML_ENTITIES} ]>\n`;\n"],"names":["initializing","async","initialize","promise","PromiseDelegate","resolve","render","content","options","dark","tag","document","body","dataset","jpThemeLight","flags","result","trim","includes","undefined","HEADER","fontFamily","getComputedStyle","getPropertyValue","replace","viewBox","match","styles","dimensions","push","join","encodeURIComponent"],"sourceRoot":""}