(window.webpackJsonp=window.webpackJsonp||[]).push([[4],{500:function(e,t,n){"use strict";n.r(t);var a=n(288),r=n.n(a),c=n(72),l=n.n(c),o=n(14),i=n.n(o),u=n(0),s=n.n(u),m=n(4),p=n(301),d=n.n(p),f=n(35),b=n.n(f),g=n(51),v=n.n(g),h=n(295),y=n.n(h),O=n(1),E=n(345),j=n.n(E),C=n(353),N=n.n(C),S=n(7),w=n(8),P=n(47),k=n(317),R=n(289),I=n(293),_=n(50),x=n(354),L=n(33),T=n.n(L),q=n(34),z=n.n(q),D=n(129),M=n.n(D),B=n(36),A=n.n(B),F=n(37),U=n.n(F),J=n(21),V=n.n(J),G=n(3),H=n.n(G),K=n(39);function Q(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,a=V()(e);if(t){var r=V()(this).constructor;n=Reflect.construct(a,arguments,r)}else n=a.apply(this,arguments);return U()(this,n)}}var W=function(e){A()(n,e);var t=Q(n);function n(e){var a;return T()(this,n),a=t.call(this,e),r()(M()(a),"setValue",(function(e){a.props.handleChange(e)})),r()(M()(a),"loadCustomMenu",(function(){return new Promise((function(e){if("external"===a.props.type)import("".concat(Object(K.a)(),"/custom/").concat(a.props.fileName,".js")).then((function(t){var n=t.default;e(n)}));else{var t=Object(P.d)().meta.name;require(["app/".concat(t,"/js/build/custom/").concat(a.props.fileName)],(function(t){return e(t)}))}}))})),a.state={loading:!0},a.shouldRender=!0,a}return z()(n,[{key:"componentDidMount",value:function(){var e=this,t=Object(P.d)();this.setState({loading:!0}),this.loadCustomMenu().then((function(n){new n(t,e.el,e.setValue).render(),e.setState({loading:!1})}))}},{key:"shouldComponentUpdate",value:function(e,t){return!(t.loading||!this.shouldRender)&&(this.shouldRender=!1,!0)}},{key:"render",value:function(){var e=this;return s.a.createElement(s.a.Fragment,null,this.state.loading&&Object(S._)("Loading..."),s.a.createElement("span",{ref:function(t){e.el=t},style:{visibility:this.state.loading?"hidden":"visible"}}))}}]),n}(u.Component);W.propTypes={fileName:H.a.string.isRequired,type:H.a.string,handleChange:H.a.func};var X=W,Y=n(361),Z=n(322),$=n(362),ee=n(130),te=n.n(ee),ne=n(76),ae=n.n(ne),re=n(15),ce=n(325);function le(e){var t=e.handleRequestClose,n=e.serviceName,a=e.mode,r=e.stanzaName,c=e.formLabel,o=Object(u.useRef)(),i=Object(u.useState)(!1),m=l()(i,2),p=m[0],f=m[1],g=Object(S._)("Submit");a===I.c?g=Object(S._)("Add"):a===I.a?g=Object(S._)("Clone Input"):a===I.d&&(g=Object(S._)("Update"));var v={boxShadow:Object(re.useSplunkTheme)().embossShadow,padding:"1%",backgroundColor:"white"};return s.a.createElement(d.a,{gutter:8},s.a.createElement(d.a.Row,{style:{padding:"5px 0px"}},s.a.createElement(d.a.Column,null,s.a.createElement(k.a,null,s.a.createElement(te.a,{onClick:t},Object(S._)("Inputs"))," > ",Object(S._)(c)))),s.a.createElement(d.a.Row,null,s.a.createElement(d.a.Column,{span:2}),s.a.createElement(d.a.Column,{span:8,style:v},s.a.createElement(ce.a,{ref:o,page:_.b,serviceName:n,mode:a,stanzaName:r,handleFormSubmit:function(e,n){f(e),n&&t()}})),s.a.createElement(d.a.Column,{span:2})),s.a.createElement(d.a.Row,null,s.a.createElement(d.a.Column,{span:7}),s.a.createElement(d.a.Column,{span:3,style:{textAlign:"right"}},s.a.createElement(b.a,{appearance:"secondary",onClick:t,label:Object(S._)("Cancel"),disabled:p}),s.a.createElement(b.a,{appearance:"primary",label:p?s.a.createElement(ae.a,null):g,onClick:function(){o.current.handleSubmit()&&t()},disabled:p})),s.a.createElement(d.a.Column,{span:2})))}le.propTypes={handleRequestClose:H.a.func,serviceName:H.a.string,mode:H.a.string,stanzaName:H.a.string,formLabel:H.a.string};var oe,ie=Object(u.memo)(le),ue=n(321);function se(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function me(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?se(Object(n),!0).forEach((function(t){r()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):se(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var pe=Object(O.default)(d.a.Row)(oe||(oe=i()(["\n    padding: 5px 0px;\n\n    .dropdown {\n        text-align: right;\n    }\n\n    .input_button {\n        text-align: right;\n        margin-right: 0px;\n    }\n"])));t.default=function(){var e,t,n=Object(u.useState)({open:!1}),a=l()(n,2),r=a[0],c=a[1],o=Object(P.d)(),i=o.pages.inputs,p=i.services,f=i.title,g=i.description,h=i.menu,O=!!(null===(e=o.pages.inputs)||void 0===e?void 0:e.table),E=Object(u.useState)(p[0].name),C=l()(E,2),L=C[0],T=C[1],q=Object(u.useState)((null===(t=p[0])||void 0===t?void 0:t.description)||""),z=l()(q,2),D=z[0],M=z[1],B=Object(u.useState)(p[0].title),A=l()(B,2),F=A[0],U=A[1],J=s.a.createElement(b.a,{appearance:"primary",id:"addInputBtn",label:Object(S._)("Create New Input"),isMenu:!0}),V=[I.a,I.c,I.d],G=p.map((function(e){return e.name})),H=Object(m.d)(),K=Object(ue.a)();Object(u.useEffect)((function(){Q(),W()}),[H.location.search]);var Q=function(){var e=p.find((function(e){return e.name===K.get("service")}));K&&e&&V.includes(K.get("action"))&&!r.open?K.get("action")!==I.c&&r.stanzaName?c(me(me({},r),{},{open:!0,isInputPageStyle:!0,serviceName:K.get("service"),mode:K.get("action")})):c(me(me({},r),{},{open:!0,isInputPageStyle:!0,serviceName:K.get("service"),formLabel:"Create ".concat(null==e?void 0:e.title),mode:I.c})):K.get("service")&&K.get("action")||!r.open||!r.isInputPageStyle||c(me(me({},r),{},{open:!1}))},W=function(){K&&G.includes(K.get("service"))&&T(K.get("service"))},ee=function(e,t){var n=p.find((function(t){return t.name===e})).style===x.b;c(me(me({},r),{},{open:!0,serviceName:e,mode:I.c,formLabel:"Add ".concat(t),isInputPageStyle:n})),n&&(K.set("service",e),K.set("action",I.c),H.push({search:K.toString()}))},te=function(){c(me(me({},r),{},{open:!1}))},ne=function(e,t){var n,a=null===(n=p.find((function(t){return t.name===e.serviceName})))||void 0===n?void 0:n.title;c(me(me({},r),{},{open:!0,isInputPageStyle:!0,serviceName:e.serviceName,stanzaName:e.name,formLabel:t===I.a?"Clone ".concat(a):"Update ".concat(a),mode:t})),K.set("service",e.serviceName),K.set("action",t),H.push({search:K.toString()})},ae=function(){c(me(me({},r),{},{open:!1})),K.delete("action"),H.push({search:K.toString()})},re=function(e){var t=e.service;ee(t,p.find((function(e){return e.name===t})).title)},ce=Object(u.useCallback)((function(e,t){var n=t.selectedTabId;T(n);var a=p.find((function(e){return e.name===n}));a&&(M(a.description),U(a.title)),K.set("service",n),K.delete("action"),H.push({search:K.toString()})}),[L]);return s.a.createElement($.a,null,s.a.createElement(R.a,{value:null},r.isInputPageStyle&&r.open?s.a.createElement(ie,{open:r.open,handleRequestClose:ae,serviceName:r.serviceName,stanzaName:r.stanzaName,mode:r.mode,formLabel:r.formLabel}):null," ",s.a.createElement("div",{style:r.isInputPageStyle&&r.open?{display:"none"}:{display:"block"}},s.a.createElement(d.a,{gutter:8},s.a.createElement(pe,null,s.a.createElement(d.a.Column,{span:9},s.a.createElement(k.b,null,O?Object(S._)(f||""):Object(S._)(F)),s.a.createElement(k.a,null,O?Object(S._)(g||""):Object(S._)(D||""))),O?!p||null!=h&&h.src?s.a.createElement(d.a.Column,{span:3,className:"input_button"},s.a.createElement(X,{fileName:h.src,type:h.type,handleChange:re})):p.length>1?s.a.createElement(d.a.Column,{className:"dropdown",span:3},s.a.createElement(v.a,{toggle:J},s.a.createElement(y.a,{onClick:function(e){var t=p[p.findIndex((function(t){return t.title===e.target.innerText}))].name;ee(t,e.target.innerText)}},p.map((function(e){return s.a.createElement(y.a.Item,{key:e.name},e.title)}))))):s.a.createElement(d.a.Column,{span:3,className:"input_button"},s.a.createElement(b.a,{label:Object(w.a)(100),appearance:"primary",id:"addInputBtn",onClick:function(){ee(p[0].name,p[0].title)}})):null)),O?s.a.createElement(Y.a,{page:_.b,handleOpenPageStyleDialog:ne}):s.a.createElement(s.a.Fragment,null,s.a.createElement(N.a,{activeTabId:L,onChange:ce},p.map((function(e){return s.a.createElement(N.a.Tab,{key:e.name,label:Object(S._)(e.title),tabId:e.name}," ")}))),p.map((function(e){return s.a.createElement("div",{key:e.name,style:e.name!==L?{display:"none"}:{display:"block"},id:"".concat(e.name,"Tab")},s.a.createElement(Y.a,{page:_.b,serviceName:e.name,handleRequestModalOpen:function(){return ee(e.name,e.title)},handleOpenPageStyleDialog:ne}))}))),s.a.createElement(j.a,{position:"top-right"}),!r.isInputPageStyle&&r.open?s.a.createElement(Z.a,{page:_.b,open:r.open,handleRequestClose:te,serviceName:r.serviceName,mode:I.c,formLabel:r.formLabel}):null)))}}}]);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vLi9zcmMvbWFpbi93ZWJhcHAvY29tcG9uZW50cy9DdXN0b21NZW51LmpzeCIsIndlYnBhY2s6Ly8vLi9zcmMvbWFpbi93ZWJhcHAvY29tcG9uZW50cy9FbnRpdHlQYWdlLmpzeCIsIndlYnBhY2s6Ly8vLi9zcmMvbWFpbi93ZWJhcHAvcGFnZXMvSW5wdXQvSW5wdXRQYWdlLmpzeCJdLCJuYW1lcyI6WyJDdXN0b21NZW51IiwicHJvcHMiLCJuZXdWYWx1ZSIsImhhbmRsZUNoYW5nZSIsIlByb21pc2UiLCJyZXNvbHZlIiwidHlwZSIsImltcG9ydCIsImdldEJ1aWxkRGlyUGF0aCIsImZpbGVOYW1lIiwidGhlbiIsImV4dGVybmFsIiwiQ29udHJvbCIsImFwcE5hbWUiLCJnZXRVbmlmaWVkQ29uZmlncyIsIm1ldGEiLCJuYW1lIiwiX19ub25fd2VicGFja19yZXF1aXJlX18iLCJzdGF0ZSIsImxvYWRpbmciLCJzaG91bGRSZW5kZXIiLCJnbG9iYWxDb25maWciLCJ0aGlzIiwic2V0U3RhdGUiLCJsb2FkQ3VzdG9tTWVudSIsImVsIiwic2V0VmFsdWUiLCJyZW5kZXIiLCJuZXh0UHJvcHMiLCJuZXh0U3RhdGUiLCJfIiwicmVmIiwic3R5bGUiLCJ2aXNpYmlsaXR5IiwiQ29tcG9uZW50IiwicHJvcFR5cGVzIiwiUHJvcFR5cGVzIiwic3RyaW5nIiwiaXNSZXF1aXJlZCIsImZ1bmMiLCJFbnRpdHlQYWdlIiwiaGFuZGxlUmVxdWVzdENsb3NlIiwic2VydmljZU5hbWUiLCJtb2RlIiwic3RhbnphTmFtZSIsImZvcm1MYWJlbCIsImZvcm0iLCJ1c2VSZWYiLCJ1c2VTdGF0ZSIsImlzU3VibWl0dGluZyIsInNldElzU3VibWl0dGluZyIsImJ1dHRvblRleHQiLCJNT0RFX0NSRUFURSIsIk1PREVfQ0xPTkUiLCJNT0RFX0VESVQiLCJjb2xTdHlsZSIsImJveFNoYWRvdyIsInVzZVNwbHVua1RoZW1lIiwiZW1ib3NzU2hhZG93IiwicGFkZGluZyIsImJhY2tncm91bmRDb2xvciIsImd1dHRlciIsIlJvdyIsIkNvbHVtbiIsIm9uQ2xpY2siLCJzcGFuIiwiQmFzZUZvcm1WaWV3IiwicGFnZSIsIlBBR0VfSU5QVVQiLCJoYW5kbGVGb3JtU3VibWl0Iiwic2V0IiwiY2xvc2UiLCJ0ZXh0QWxpZ24iLCJhcHBlYXJhbmNlIiwibGFiZWwiLCJkaXNhYmxlZCIsImN1cnJlbnQiLCJoYW5kbGVTdWJtaXQiLCJtZW1vIiwic3R5bGVkIiwiQ29sdW1uTGF5b3V0IiwiSW5wdXRQYWdlIiwib3BlbiIsImVudGl0eSIsInNldEVudGl0eSIsInVuaWZpZWRDb25maWdzIiwicGFnZXMiLCJpbnB1dHMiLCJzZXJ2aWNlcyIsInRpdGxlIiwiZGVzY3JpcHRpb24iLCJjdXN0b21NZW51RmllbGQiLCJtZW51IiwiaXNPdXRlclRhYmxlIiwidGFibGUiLCJhY3RpdmVUYWJJZCIsInNldEFjdGl2ZVRhYklkIiwic2VsZWN0ZWRUYWJEZXNjcmlwdGlvbiIsInNldFNlbGVjdGVkVGFiRGVzY3JpcHRpb24iLCJzZWxlY3RlZFRhYlRpdGxlIiwic2V0U2VsZWN0ZWRUYWJUaXRsZSIsInRvZ2dsZSIsImlkIiwiaXNNZW51IiwiUEVSTUlUVEVEX01PREVTIiwicGVybWl0dGVkVGFiTmFtZXMiLCJtYXAiLCJzZXJ2aWNlIiwiaGlzdG9yeSIsInVzZUhpc3RvcnkiLCJxdWVyeSIsInVzZVF1ZXJ5IiwidXNlRWZmZWN0Iiwic2V0U2VydmljZUVudGl0eSIsInNldEFjdGl2ZVRhYiIsImxvY2F0aW9uIiwic2VhcmNoIiwiZmluZCIsIngiLCJnZXQiLCJpbmNsdWRlcyIsImlzSW5wdXRQYWdlU3R5bGUiLCJoYW5kbGVSZXF1ZXN0T3BlbiIsInNlcnZpY2VUaXRsZSIsIlNUWUxFX1BBR0UiLCJwdXNoIiwidG9TdHJpbmciLCJoYW5kbGVNb2RhbERpYWxvZ0Nsb3NlIiwiaGFuZGxlT3BlblBhZ2VTdHlsZURpYWxvZyIsInJvdyIsImhhbmRsZVBhZ2VEaWFsb2dDbG9zZSIsImhhbmRsZUNoYW5nZUN1c3RvbU1lbnUiLCJ2YWwiLCJvblRhYkNoYW5nZSIsInVzZUNhbGxiYWNrIiwiZSIsInNlbGVjdGVkVGFiSWQiLCJzZWxlY3RlZFRhYkluZm8iLCJFcnJvckJvdW5kYXJ5IiwiVGFibGVDb250ZXh0IiwidmFsdWUiLCJkaXNwbGF5Iiwic3JjIiwiY2xhc3NOYW1lIiwiUmVhY3QiLCJjcmVhdGVFbGVtZW50IiwibGVuZ3RoIiwiZXZlbnQiLCJmaW5kbmFtZSIsImZpbmRJbmRleCIsInRhcmdldCIsImlubmVyVGV4dCIsIkl0ZW0iLCJrZXkiLCJnZXRGb3JtYXR0ZWRNZXNzYWdlIiwiVGFibGVXcmFwcGVyIiwib25DaGFuZ2UiLCJUYWIiLCJ0YWJJZCIsImhhbmRsZVJlcXVlc3RNb2RhbE9wZW4iLCJwb3NpdGlvbiIsIkVudGl0eU1vZGFsIl0sIm1hcHBpbmdzIjoibTVCQU1NQSxFLGdDQUNGLFdBQVlDLEdBQU8seUJBQ2YsY0FBTUEsR0FEUyx1QkEwQlIsU0FBQ0MsR0FDUixFQUFLRCxNQUFNRSxhQUFhRCxNQTNCVCw2QkE4QkYsV0FDYixPQUFPLElBQUlFLFNBQVEsU0FBQ0MsR0FDaEIsR0FBd0IsYUFBcEIsRUFBS0osTUFBTUssS0FDWEMsT0FBQSxVQUNpQ0MsY0FEakMsbUJBRVEsRUFBS1AsTUFBTVEsU0FGbkIsUUFJRUMsTUFBSyxTQUFDQyxHQUNKLElBQU1DLEVBQVVELEVBQVEsUUFDeEJOLEVBQVFPLFVBRVQsQ0FDSCxJQUNNQyxFQURlQyxjQUNRQyxLQUFLQyxLQUNsQ0MsUUFDSSxDQUFDLE9BQUQsT0FBUUosRUFBUiw0QkFBbUMsRUFBS1osTUFBTVEsWUFDOUMsU0FBQ0csR0FBRCxPQUFhUCxFQUFRTyxhQTVDakMsRUFBS00sTUFBUSxDQUNUQyxTQUFTLEdBRWIsRUFBS0MsY0FBZSxFQUxMLEUsNkNBUW5CLFdBQW9CLFdBQ1ZDLEVBQWVQLGNBQ3JCUSxLQUFLQyxTQUFTLENBQUVKLFNBQVMsSUFDekJHLEtBQUtFLGlCQUFpQmQsTUFBSyxTQUFDRSxHQUNGLElBQUlBLEVBQVFTLEVBQWMs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LEtBQU13RSxFQUFTLEdBQUdDLFdBMENwQyxPQUtaSSxFQUNJLGtCQUFDOEQsRUFBQSxFQUFELENBQ0l4RixLQUFNQyxJQUNONEQsMEJBQTJCQSxLQUcvQixvQ0FDSSxrQkFBQyxJQUFELENBQVFqQyxZQUFhQSxFQUFhNkQsU0FBVXZCLElBQ3ZDN0MsRUFBU2tCLEtBQUksU0FBQ0MsR0FDWCxPQUFRLGtCQUFDLElBQU9rRCxJQUFSLENBQVlKLElBQUs5QyxFQUFRM0YsS0FBTTBELE1BQU81QyxZQUFFNkUsRUFBUWxCLE9BQVFxRSxNQUFPbkQsRUFBUTNGLE1BQXZFLFNBSVp3RSxFQUFTa0IsS0FBSSxTQUFDQyxHQUNWLE9BQ0kseUJBQ0k4QyxJQUFLOUMsRUFBUTNGLEtBQ2JnQixNQUNJMkUsRUFBUTNGLE9BQVMrRSxFQUFjLENBQUU4QyxRQUFTLFFBQVcsQ0FBRUEsUUFBUyxTQUVwRXZDLEdBQUUsVUFBS0ssRUFBUTNGLEtBQWIsUUFFRixrQkFBQzJJLEVBQUEsRUFBRCxDQUNJeEYsS0FBTUMsSUFDTjFCLFlBQWFpRSxFQUFRM0YsS0FDckIrSSx1QkFBd0Isa0JBQU1yQyxHQUFrQmYsRUFBUTNGLEtBQU0yRixFQUFRbEIsUUFDdEV1QywwQkFBMkJBLFVBVTNELGtCQUFDLElBQUQsQ0FBZWdDLFNBQVMsZUFDdEI3RSxFQUFPc0Msa0JBQW9CdEMsRUFBT0QsS0E1TDVDLGtCQUFDK0UsRUFBQSxFQUFELENBQ0k5RixLQUFNQyxJQUNOYyxLQUFNQyxFQUFPRCxLQUNiekMsbUJBQW9Cc0YsR0FDcEJyRixZQUFheUMsRUFBT3pDLFlBQ3BCQyxLQUFNUyxJQUNOUCxVQUFXc0MsRUFBT3RDLFlBc0xxRCIsImZpbGUiOiI0LmpzIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IFJlYWN0LCB7IENvbXBvbmVudCB9IGZyb20gJ3JlYWN0JztcbmltcG9ydCBQcm9wVHlwZXMgZnJvbSAncHJvcC10eXBlcyc7XG5pbXBvcnQgeyBfIH0gZnJvbSAnQHNwbHVuay91aS11dGlscy9pMThuJztcbmltcG9ydCB7IGdldFVuaWZpZWRDb25maWdzIH0gZnJvbSAnLi4vdXRpbC91dGlsJztcbmltcG9ydCB7IGdldEJ1aWxkRGlyUGF0aCB9IGZyb20gJy4uL3V0aWwvc2NyaXB0JztcblxuY2xhc3MgQ3VzdG9tTWVudSBleHRlbmRzIENvbXBvbmVudCB7XG4gICAgY29uc3RydWN0b3IocHJvcHMpIHtcbiAgICAgICAgc3VwZXIocHJvcHMpO1xuICAgICAgICB0aGlzLnN0YXRlID0ge1xuICAgICAgICAgICAgbG9hZGluZzogdHJ1ZSxcbiAgICAgICAgfTtcbiAgICAgICAgdGhpcy5zaG91bGRSZW5kZXIgPSB0cnVlO1xuICAgIH1cblxuICAgIGNvbXBvbmVudERpZE1vdW50KCkge1xuICAgICAgICBjb25zdCBnbG9iYWxDb25maWcgPSBnZXRVbmlmaWVkQ29uZmlncygpO1xuICAgICAgICB0aGlzLnNldFN0YXRlKHsgbG9hZGluZzogdHJ1ZSB9KTtcbiAgICAgICAgdGhpcy5sb2FkQ3VzdG9tTWVudSgpLnRoZW4oKENvbnRyb2wpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IGN1c3RvbUNvbnRyb2wgPSBuZXcgQ29udHJvbChnbG9iYWxDb25maWcsIHRoaXMuZWwsIHRoaXMuc2V0VmFsdWUpO1xuICAgICAgICAgICAgY3VzdG9tQ29udHJvbC5yZW5kZXIoKTtcbiAgICAgICAgICAgIHRoaXMuc2V0U3RhdGUoeyBsb2FkaW5nOiBmYWxzZSB9KTtcbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgc2hvdWxkQ29tcG9uZW50VXBkYXRlKG5leHRQcm9wcywgbmV4dFN0YXRlKSB7XG4gICAgICAgIGlmICghbmV4dFN0YXRlLmxvYWRpbmcgJiYgdGhpcy5zaG91bGRSZW5kZXIpIHtcbiAgICAgICAgICAgIHRoaXMuc2hvdWxkUmVuZGVyID0gZmFsc2U7XG4gICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuXG4gICAgc2V0VmFsdWUgPSAobmV3VmFsdWUpID0+IHtcbiAgICAgICAgdGhpcy5wcm9wcy5oYW5kbGVDaGFuZ2UobmV3VmFsdWUpO1xuICAgIH07XG5cbiAgICBsb2FkQ3VzdG9tTWVudSA9ICgpID0+IHtcbiAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlKSA9PiB7XG4gICAgICAgICAgICBpZiAodGhpcy5wcm9wcy50eXBlID09PSAnZXh0ZXJuYWwnKSB7XG4gICAgICAgICAgICAgICAgaW1wb3J0KFxuICAgICAgICAgICAgICAgICAgICAvKiB3ZWJwYWNrSWdub3JlOiB0cnVlICovIGAke2dldEJ1aWxkRGlyUGF0aCgpfS9jdXN0b20vJHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMucHJvcHMuZmlsZU5hbWVcbiAgICAgICAgICAgICAgICAgICAgfS5qc2BcbiAgICAgICAgICAgICAgICApLnRoZW4oKGV4dGVybmFsKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IENvbnRyb2wgPSBleHRlcm5hbC5kZWZhdWx0O1xuICAgICAgICAgICAgICAgICAgICByZXNvbHZlKENvbnRyb2wpO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBjb25zdCBnbG9iYWxDb25maWcgPSBnZXRVbmlmaWVkQ29uZmlncygpO1xuICAgICAgICAgICAgICAgIGNvbnN0IGFwcE5hbWUgPSBnbG9iYWxDb25maWcubWV0YS5uYW1lO1xuICAgICAgICAgICAgICAgIF9fbm9uX3dlYnBhY2tfcmVxdWlyZV9fKFxuICAgICAgICAgICAgICAgICAgICBbYGFwcC8ke2FwcE5hbWV9L2pzL2J1aWxkL2N1c3RvbS8ke3RoaXMucHJvcHMuZmlsZU5hbWV9YF0sXG4gICAgICAgICAgICAgICAgICAgIChDb250cm9sKSA9PiByZXNvbHZlKENvbnRyb2wpXG4gICAgICAgICAgICAgICAgKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgfTtcblxuICAgIHJlbmRlcigpIHtcbiAgICAgICAgcmV0dXJuIChcbiAgICAgICAgICAgIDw+XG4gICAgICAgICAgICAgICAge3RoaXMuc3RhdGUubG9hZGluZyAmJiBfKCdMb2FkaW5nLi4uJyl9XG4gICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICA8c3BhblxuICAgICAgICAgICAgICAgICAgICAgICAgcmVmPXsoZWwpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmVsID0gZWw7XG4gICAgICAgICAgICAgICAgICAgICAgICB9fVxuICAgICAgICAgICAgICAgICAgICAgICAgc3R5bGU9e3sgdmlzaWJpbGl0eTogdGhpcy5zdGF0ZS5sb2FkaW5nID8gJ2hpZGRlbicgOiAndmlzaWJsZScgfX1cbiAgICAgICAgICAgICAgICAgICAgLz5cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICA8Lz5cbiAgICAgICAgKTtcbiAgICB9XG59XG5cbkN1c3RvbU1lbnUucHJvcFR5cGVzID0ge1xuICAgIGZpbGVOYW1lOiBQcm9wVHlwZXMuc3RyaW5nLmlzUmVxdWlyZWQsXG4gICAgdHlwZTogUHJvcFR5cGVzLnN0cmluZyxcbiAgICBoYW5kbGVDaGFuZ2U6IFByb3BUeXBlcy5mdW5jLFxufTtcblxuZXhwb3J0IGRlZmF1bHQgQ3VzdG9tTWVudTtcbiIsImltcG9ydCBSZWFjdCwgeyBtZW1vLCB1c2VSZWYsIHVzZVN0YXRlIH0gZnJvbSAncmVhY3QnO1xuaW1wb3J0IFByb3BUeXBlcyBmcm9tICdwcm9wLXR5cGVzJztcblxuaW1wb3J0IEJ1dHRvbiBmcm9tICdAc3BsdW5rL3JlYWN0LXVpL0J1dHRvbic7XG5pbXBvcnQgTGluayBmcm9tICdAc3BsdW5rL3JlYWN0LXVpL0xpbmsnO1xuaW1wb3J0IFdhaXRTcGlubmVyIGZyb20gJ0BzcGx1bmsvcmVhY3QtdWkvV2FpdFNwaW5uZXInO1xuaW1wb3J0IENvbHVtbkxheW91dCBmcm9tICdAc3BsdW5rL3JlYWN0LXVpL0NvbHVtbkxheW91dCc7XG5pbXBvcnQgeyBfIH0gZnJvbSAnQHNwbHVuay91aS11dGlscy9pMThuJztcbmltcG9ydCB7IHVzZVNwbHVua1RoZW1lIH0gZnJvbSAnQHNwbHVuay90aGVtZXMnO1xuXG5pbXBvcnQgeyBNT0RFX0NMT05FLCBNT0RFX0NSRUFURSwgTU9ERV9FRElUIH0gZnJvbSAnLi4vY29uc3RhbnRzL21vZGVzJztcbmltcG9ydCB7IFBBR0VfSU5QVVQgfSBmcm9tICcuLi9jb25zdGFudHMvcGFnZXMnO1xuaW1wb3J0IEJhc2VGb3JtVmlldyBmcm9tICcuL0Jhc2VGb3JtVmlldyc7XG5pbXBvcnQgeyBTdWJUaXRsZUNvbXBvbmVudCB9IGZyb20gJy4uL3BhZ2VzL0lucHV0L0lucHV0UGFnZVN0eWxlJztcblxuZnVuY3Rpb24gRW50aXR5UGFnZSh7IGhhbmRsZVJlcXVlc3RDbG9zZSwgc2VydmljZU5hbWUsIG1vZGUsIHN0YW56YU5hbWUsIGZvcm1MYWJlbCB9KSB7XG4gICAgLy8gUmVmIGlzIHVzZWQgaGVyZSB0byBjYWxsIHN1Ym1pdCBtZXRob2Qgb2YgZm9ybSBvbmx5XG4gICAgY29uc3QgZm9ybSA9IHVzZVJlZigpOyAvLyBub3NlbWdyZXA6IHR5cGVzY3JpcHQucmVhY3Quc2VjdXJpdHkuYXVkaXQucmVhY3Qtbm8tcmVmcy5yZWFjdC1uby1yZWZzXG4gICAgY29uc3QgW2lzU3VibWl0dGluZywgc2V0SXNTdWJtaXR0aW5nXSA9IHVzZVN0YXRlKGZhbHNlKTtcbiAgICBsZXQgYnV0dG9uVGV4dCA9IF8oJ1N1Ym1pdCcpO1xuXG4gICAgaWYgKG1vZGUgPT09IE1PREVfQ1JFQVRFKSB7XG4gICAgICAgIGJ1dHRvblRleHQgPSBfKCdBZGQnKTtcbiAgICB9IGVsc2UgaWYgKG1vZGUgPT09IE1PREVfQ0xPTkUpIHtcbiAgICAgICAgYnV0dG9uVGV4dCA9IF8oJ0Nsb25lIElucHV0Jyk7XG4gICAgfSBlbHNlIGlmIChtb2RlID09PSBNT0RFX0VESVQpIHtcbiAgICAgICAgYnV0dG9uVGV4dCA9IF8oJ1VwZGF0ZScpO1xuICAgIH1cblxuICAgIGNvbnN0IHsgZW1ib3NzU2hhZG93IH0gPSB1c2VTcGx1bmtUaGVtZSgpO1xuICAgIGNvbnN0IGNvbFN0eWxlID0ge1xuICAgICAgICBib3hTaGFkb3c6IGVtYm9zc1NoYWRvdyxcbiAgICAgICAgcGFkZGluZzogJzElJyxcbiAgICAgICAgYmFja2dyb3VuZENvbG9yOiAnd2hpdGUnLFxuICAgIH07XG5cbiAgICBjb25zdCBoYW5kbGVTdWJtaXQgPSAoKSA9PiB7XG4gICAgICAgIGNvbnN0IHJlc3VsdCA9IGZvcm0uY3VycmVudC5oYW5kbGVTdWJtaXQoKTtcbiAgICAgICAgaWYgKHJlc3VsdCkge1xuICAgICAgICAgICAgaGFuZGxlUmVxdWVzdENsb3NlKCk7XG4gICAgICAgIH1cbiAgICB9O1xuXG4gICAgY29uc3QgaGFuZGxlRm9ybVN1Ym1pdCA9IChzZXQsIGNsb3NlKSA9PiB7XG4gICAgICAgIHNldElzU3VibWl0dGluZyhzZXQpO1xuICAgICAgICBpZiAoY2xvc2UpIHtcbiAgICAgICAgICAgIGhhbmRsZVJlcXVlc3RDbG9zZSgpO1xuICAgICAgICB9XG4gICAgfTtcbiAgICByZXR1cm4gKFxuICAgICAgICA8Q29sdW1uTGF5b3V0IGd1dHRlcj17OH0+XG4gICAgICAgICAgICA8Q29sdW1uTGF5b3V0LlJvdyBzdHlsZT17eyBwYWRkaW5nOiAnNXB4IDBweCcgfX0+XG4gICAgICAgICAgICAgICAgPENvbHVtbkxheW91dC5Db2x1bW4+XG4gICAgICAgICAgICAgICAgICAgIDxTdWJUaXRsZUNvbXBvbmVudD5cbiAgICAgICAgICAgICAgICAgICAgICAgIDxMaW5rIG9uQ2xpY2s9e2hhbmRsZVJlcXVlc3RDbG9zZX0+e18oJ0lucHV0cycpfTwvTGluaz5cbiAgICAgICAgICAgICAgICAgICAgICAgIHsnID4gJ31cbiAgICAgICAgICAgICAgICAgICAgICAgIHtfKGZvcm1MYWJlbCl9XG4gICAgICAgICAgICAgICAgICAgIDwvU3ViVGl0bGVDb21wb25lbnQ+XG4gICAgICAgICAgICAgICAgPC9Db2x1bW5MYXlvdXQuQ29sdW1uPlxuICAgICAgICAgICAgPC9Db2x1bW5MYXlvdXQuUm93PlxuICAgICAgICAgICAgPENvbHVtbkxheW91dC5Sb3c+XG4gICAgICAgICAgICAgICAgPENvbHVtbkxheW91dC5Db2x1bW4gc3Bhbj17Mn0gLz5cbiAgICAgICAgICAgICAgICA8Q29sdW1uTGF5b3V0LkNvbHVtbiBzcGFuPXs4fSBzdHlsZT17Y29sU3R5bGV9PlxuICAgICAgICAgICAgICAgICAgICA8QmFzZUZvcm1WaWV3IC8vIG5vc2VtZ3JlcDogdHlwZXNjcmlwdC5yZWFjdC5zZWN1cml0eS5hdWRpdC5yZWFjdC1uby1yZWZzLnJlYWN0LW5vLXJlZnNcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlZj17Zm9ybX1cbiAgICAgICAgICAgICAgICAgICAgICAgIHBhZ2U9e1BBR0VfSU5QVVR9XG4gICAgICAgICAgICAgICAgICAgICAgICBzZXJ2aWNlTmFtZT17c2VydmljZU5hbWV9XG4gICAgICAgICAgICAgICAgICAgICAgICBtb2RlPXttb2RlfVxuICAgICAgICAgICAgICAgICAgICAgICAgc3RhbnphTmFtZT17c3RhbnphTmFtZX1cbiAgICAgICAgICAgICAgICAgICAgICAgIGhhbmRsZUZvcm1TdWJtaXQ9e2hhbmRsZUZvcm1TdWJtaXR9XG4gICAgICAgICAgICAgICAgICAgIC8+XG4gICAgICAgICAgICAgICAgPC9Db2x1bW5MYXlvdXQuQ29sdW1uPlxuICAgICAgICAgICAgICAgIDxDb2x1bW5MYXlvdXQuQ29sdW1uIHNwYW49ezJ9IC8+XG4gICAgICAgICAgICA8L0NvbHVtbkxheW91dC5Sb3c+XG4gICAgICAgICAgICA8Q29sdW1uTGF5b3V0LlJvdz5cbiAgICAgICAgICAgICAgICA8Q29sdW1uTGF5b3V0LkNvbHVtbiBzcGFuPXs3fSAvPlxuICAgICAgICAgICAgICAgIDxDb2x1bW5MYXlvdXQuQ29sdW1uIHNwYW49ezN9IHN0eWxlPXt7IHRleHRBbGlnbjogJ3JpZ2h0JyB9fT5cbiAgICAgICAgICAgICAgICAgICAgPEJ1dHRvblxuICAgICAgICAgICAgICAgICAgICAgICAgYXBwZWFyYW5jZT1cInNlY29uZGFyeVwiXG4gICAgICAgICAgICAgICAgICAgICAgICBvbkNsaWNrPXtoYW5kbGVSZXF1ZXN0Q2xvc2V9XG4gICAgICAgICAgICAgICAgICAgICAgICBsYWJlbD17XygnQ2FuY2VsJyl9XG4gICAgICAgICAgICAgICAgICAgICAgICBkaXNhYmxlZD17aXNTdWJtaXR0aW5nfVxuICAgICAgICAgICAgICAgICAgICAvPlxuICAgICAgICAgICAgICAgICAgICA8QnV0dG9uXG4gICAgICAgICAgICAgICAgICAgICAgICBhcHBlYXJhbmNlPVwicHJpbWFyeVwiXG4gICAgICAgICAgICAgICAgICAgICAgICBsYWJlbD17aXNTdWJtaXR0aW5nID8gPFdhaXRTcGlubmVyIC8+IDogYnV0dG9uVGV4dH1cbiAgICAgICAgICAgICAgICAgICAgICAgIG9uQ2xpY2s9e2hhbmRsZVN1Ym1pdH1cbiAgICAgICAgICAgICAgICAgICAgICAgIGRpc2FibGVkPXtpc1N1Ym1pdHRpbmd9XG4gICAgICAgICAgICAgICAgICAgIC8+XG4gICAgICAgICAgICAgICAgPC9Db2x1bW5MYXlvdXQuQ29sdW1uPlxuICAgICAgICAgICAgICAgIDxDb2x1bW5MYXlvdXQuQ29sdW1uIHNwYW49ezJ9IC8+XG4gICAgICAgICAgICA8L0NvbHVtbkxheW91dC5Sb3c+XG4gICAgICAgIDwvQ29sdW1uTGF5b3V0PlxuICAgICk7XG59XG5cbkVudGl0eVBhZ2UucHJvcFR5cGVzID0ge1xuICAgIGhhbmRsZVJlcXVlc3RDbG9zZTogUHJvcFR5cGVzLmZ1bmMsXG4gICAgc2VydmljZU5hbWU6IFByb3BUeXBlcy5zdHJpbmcsXG4gICAgbW9kZTogUHJvcFR5cGVzLnN0cmluZyxcbiAgICBzdGFuemFOYW1lOiBQcm9wVHlwZXMuc3RyaW5nLFxuICAgIGZvcm1MYWJlbDogUHJvcFR5cGVzLnN0cmluZyxcbn07XG5cbmV4cG9ydCBkZWZhdWx0IG1lbW8oRW50aXR5UGFnZSk7XG4iLCJpbXBvcnQgUmVhY3QsIHsgdXNlU3RhdGUsIHVzZUVmZmVjdCwgdXNlQ2FsbGJhY2sgfSBmcm9tICdyZWFjdCc7XG5pbXBvcnQgeyB1c2VIaXN0b3J5IH0gZnJvbSAncmVhY3Qtcm91dGVyLWRvbSc7XG5cbmltcG9ydCBDb2x1bW5MYXlvdXQgZnJvbSAnQHNwbHVuay9yZWFjdC11aS9Db2x1bW5MYXlvdXQnO1xuaW1wb3J0IEJ1dHRvbiBmcm9tICdAc3BsdW5rL3JlYWN0LXVpL0J1dHRvbic7XG5pbXBvcnQgRHJvcGRvd24gZnJvbSAnQHNwbHVuay9yZWFjdC11aS9Ecm9wZG93bic7XG5pbXBvcnQgTWVudSBmcm9tICdAc3BsdW5rL3JlYWN0LXVpL01lbnUnO1xuaW1wb3J0IHN0eWxlZCBmcm9tICdzdHlsZWQtY29tcG9uZW50cyc7XG5pbXBvcnQgVG9hc3RNZXNzYWdlcyBmcm9tICdAc3BsdW5rL3JlYWN0LXRvYXN0LW5vdGlmaWNhdGlvbnMvVG9hc3RNZXNzYWdlcyc7XG5pbXBvcnQgVGFiQmFyIGZyb20gJ0BzcGx1bmsvcmVhY3QtdWkvVGFiQmFyJztcbmltcG9ydCB7IF8gfSBmcm9tICdAc3BsdW5rL3VpLXV0aWxzL2kxOG4nO1xuaW1wb3J0IHsgZ2V0Rm9ybWF0dGVkTWVzc2FnZSB9IGZyb20gJy4uLy4uL3V0aWwvbWVzc2FnZVV0aWwnO1xuaW1wb3J0IHsgZ2V0VW5pZmllZENvbmZpZ3MgfSBmcm9tICcuLi8uLi91dGlsL3V0aWwnO1xuaW1wb3J0IHsgVGl0bGVDb21wb25lbnQsIFN1YlRpdGxlQ29tcG9uZW50IH0gZnJvbSAnLi9JbnB1dFBhZ2VTdHlsZSc7XG5pbXBvcnQgeyBUYWJsZUNvbnRleHRQcm92aWRlciB9IGZyb20gJy4uLy4uL2NvbnRleHQvVGFibGVDb250ZXh0JztcbmltcG9ydCB7IE1PREVfQ1JFQVRFLCBNT0RFX0NMT05FLCBNT0RFX0VESVQgfSBmcm9tICcuLi8uLi9jb25zdGFudHMvbW9kZXMnO1xuaW1wb3J0IHsgUEFHRV9JTlBVVCB9IGZyb20gJy4uLy4uL2NvbnN0YW50cy9wYWdlcyc7XG5pbXBvcnQgeyBTVFlMRV9QQUdFIH0gZnJvbSAnLi4vLi4vY29uc3RhbnRzL2RpYWxvZ1N0eWxlcyc7XG5pbXBvcnQgQ3VzdG9tTWVudSBmcm9tICcuLi8uLi9jb21wb25lbnRzL0N1c3RvbU1lbnUnO1xuaW1wb3J0IFRhYmxlV3JhcHBlciBmcm9tICcuLi8uLi9jb21wb25lbnRzL3RhYmxlL1RhYmxlV3JhcHBlcic7XG5pbXBvcnQgRW50aXR5TW9kYWwgZnJvbSAnLi4vLi4vY29tcG9uZW50cy9FbnRpdHlNb2RhbCc7XG5pbXBvcnQgRXJyb3JCb3VuZGFyeSBmcm9tICcuLi8uLi9jb21wb25lbnRzL0Vycm9yQm91bmRhcnknO1xuaW1wb3J0IEVudGl0eVBhZ2UgZnJvbSAnLi4vLi4vY29tcG9uZW50cy9FbnRpdHlQYWdlJztcbmltcG9ydCB1c2VRdWVyeSBmcm9tICcuLi8uLi9ob29rcy91c2VRdWVyeSc7XG5cbmNvbnN0IFJvdyA9IHN0eWxlZChDb2x1bW5MYXlvdXQuUm93KWBcbiAgICBwYWRkaW5nOiA1cHggMHB4O1xuXG4gICAgLmRyb3Bkb3duIHtcbiAgICAgICAgdGV4dC1hbGlnbjogcmlnaHQ7XG4gICAgfVxuXG4gICAgLmlucHV0X2J1dHRvbiB7XG4gICAgICAgIHRleHQtYWxpZ246IHJpZ2h0O1xuICAgICAgICBtYXJnaW4tcmlnaHQ6IDBweDtcbiAgICB9XG5gO1xuXG5mdW5jdGlvbiBJbnB1dFBhZ2UoKSB7XG4gICAgY29uc3QgW2VudGl0eSwgc2V0RW50aXR5XSA9IHVzZVN0YXRlKHsgb3BlbjogZmFsc2UgfSk7XG4gICAgY29uc3QgdW5pZmllZENvbmZpZ3MgPSBnZXRVbmlmaWVkQ29uZmlncygpO1xuICAgIGNvbnN0IHsgc2VydmljZXMsIHRpdGxlLCBkZXNjcmlwdGlvbiwgbWVudTogY3VzdG9tTWVudUZpZWxkIH0gPSB1bmlmaWVkQ29uZmlncy5wYWdlcy5pbnB1dHM7XG5cbiAgICAvLyBVc2VkIGZvciBvdXRlciB0YWJsZSBpcyBwcmVzZW50IG9yIG5vdFxuICAgIGNvbnN0IHRhYmxlID0gdW5pZmllZENvbmZpZ3MucGFnZXMuaW5wdXRzPy50YWJsZTtcbiAgICBjb25zdCBpc091dGVyVGFibGUgPSAhIXRhYmxlO1xuXG4gICAgY29uc3QgW2FjdGl2ZVRhYklkLCBzZXRBY3RpdmVUYWJJZF0gPSB1c2VTdGF0ZShzZXJ2aWNlc1swXS5uYW1lKTtcbiAgICBjb25zdCBbc2VsZWN0ZWRUYWJEZXNjcmlwdGlvbiwgc2V0U2VsZWN0ZWRUYWJEZXNjcmlwdGlvbl0gPSB1c2VTdGF0ZShzZXJ2aWNlc1swXT8uZGVzY3JpcHRpb24gfHwgXCJcIik7XG4gICAgY29uc3QgW3NlbGVjdGVkVGFiVGl0bGUsIHNldFNlbGVjdGVkVGFiVGl0bGVdID0gdXNlU3RhdGUoc2VydmljZXNbMF0udGl0bGUpO1xuXG4gICAgY29uc3QgdG9nZ2xlID0gKFxuICAgICAgICA8QnV0dG9uIGFwcGVhcmFuY2U9XCJwcmltYXJ5XCIgaWQ9XCJhZGRJbnB1dEJ0blwiIGxhYmVsPXtfKCdDcmVhdGUgTmV3IElucHV0Jyl9IGlzTWVudSAvPlxuICAgICk7XG4gICAgY29uc3QgUEVSTUlUVEVEX01PREVTID0gW01PREVfQ0xPTkUsIE1PREVfQ1JFQVRFLCBNT0RFX0VESVRdO1xuICAgIGNvbnN0IHBlcm1pdHRlZFRhYk5hbWVzID0gc2VydmljZXMubWFwKChzZXJ2aWNlKSA9PiB7XG4gICAgICAgIHJldHVybiBzZXJ2aWNlLm5hbWU7XG4gICAgfSk7XG5cbiAgICBjb25zdCBoaXN0b3J5ID0gdXNlSGlzdG9yeSgpO1xuICAgIGNvbnN0IHF1ZXJ5ID0gdXNlUXVlcnkoKTtcblxuICAgIHVzZUVmZmVjdCgoKSA9PiB7XG4gICAgICAgIHNldFNlcnZpY2VFbnRpdHkoKTtcbiAgICAgICAgc2V0QWN0aXZlVGFiKCk7XG4gICAgfSwgW2hpc3RvcnkubG9jYXRpb24uc2VhcmNoXSk7XG5cbiAgICBjb25zdCBzZXRTZXJ2aWNlRW50aXR5ID0gKCkgPT4ge1xuICAgICAgICBjb25zdCBzZXJ2aWNlID0gc2VydmljZXMuZmluZCgoeCkgPT4geC5uYW1lID09PSBxdWVyeS5nZXQoJ3NlcnZpY2UnKSk7XG4gICAgICAgIC8vIFJ1biBvbmx5IHdoZW4gc2VydmljZSBhbmQgYWN0aW9uL21vZGUgaXMgdmFsaWQgYW5kIG1vZGFsL3BhZ2UgaXMgbm90IG9wZW5cbiAgICAgICAgaWYgKHF1ZXJ5ICYmIHNlcnZpY2UgJiYgUEVSTUlUVEVEX01PREVTLmluY2x1ZGVzKHF1ZXJ5LmdldCgnYWN0aW9uJykpICYmICFlbnRpdHkub3Blbikge1xuICAgICAgICAgICAgLy8gcnVuIHdoZW4gbW9kZSBpcyBub3QgY3JlYXRlIGFuZCBwcmV2aW91cyBzdGF0ZSBpbmZvIGlzIGF2YWlsYWJsZVxuICAgICAgICAgICAgaWYgKHF1ZXJ5LmdldCgnYWN0aW9uJykgIT09IE1PREVfQ1JFQVRFICYmIGVudGl0eS5zdGFuemFOYW1lKSB7XG4gICAgICAgICAgICAgICAgc2V0RW50aXR5KHtcbiAgICAgICAgICAgICAgICAgICAgLi4uZW50aXR5LFxuICAgICAgICAgICAgICAgICAgICBvcGVuOiB0cnVlLFxuICAgICAgICAgICAgICAgICAgICBpc0lucHV0UGFnZVN0eWxlOiB0cnVlLFxuICAgICAgICAgICAgICAgICAgICBzZXJ2aWNlTmFtZTogcXVlcnkuZ2V0KCdzZXJ2aWNlJyksXG4gICAgICAgICAgICAgICAgICAgIG1vZGU6IHF1ZXJ5LmdldCgnYWN0aW9uJyksXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIC8vIElmIHByZXZpb3VzIHN0YXRlIGluZm9ybWF0aW9uIGlzIHVuYXZhaWxhYmxlLCBjcmVhdGUgbW9kZSB3aWxsIGJlIHVzZWQgYnkgZGVmYXVsdFxuICAgICAgICAgICAgICAgIHNldEVudGl0eSh7XG4gICAgICAgICAgICAgICAgICAgIC4uLmVudGl0eSxcbiAgICAgICAgICAgICAgICAgICAgb3BlbjogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgICAgaXNJbnB1dFBhZ2VTdHlsZTogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgICAgc2VydmljZU5hbWU6IHF1ZXJ5LmdldCgnc2VydmljZScpLFxuICAgICAgICAgICAgICAgICAgICBmb3JtTGFiZWw6IGBDcmVhdGUgJHtzZXJ2aWNlPy50aXRsZX1gLFxuICAgICAgICAgICAgICAgICAgICBtb2RlOiBNT0RFX0NSRUFURSxcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSBlbHNlIGlmIChcbiAgICAgICAgICAgICghcXVlcnkuZ2V0KCdzZXJ2aWNlJykgfHwgIXF1ZXJ5LmdldCgnYWN0aW9uJykpICYmXG4gICAgICAgICAgICBlbnRpdHkub3BlbiAmJlxuICAgICAgICAgICAgZW50aXR5LmlzSW5wdXRQYWdlU3R5bGVcbiAgICAgICAgKSB7XG4gICAgICAgICAgICAvLyBDbG9zZSBwYWdlIHdoZW4gYW55IG9mIHRoZSByZXF1aXJlZCBxdWVyeSBwYXJhbXMgYXJlIG5vdCBwcm92aWRlZFxuICAgICAgICAgICAgc2V0RW50aXR5KHsgLi4uZW50aXR5LCBvcGVuOiBmYWxzZSB9KTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIGNvbnN0IHNldEFjdGl2ZVRhYiA9ICgpID0+IHtcbiAgICAgICAgaWYgKHF1ZXJ5ICYmIHBlcm1pdHRlZFRhYk5hbWVzLmluY2x1ZGVzKHF1ZXJ5LmdldCgnc2VydmljZScpKSkge1xuICAgICAgICAgICAgc2V0QWN0aXZlVGFiSWQocXVlcnkuZ2V0KCdzZXJ2aWNlJykpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgY29uc3QgZ2V0SW5wdXRNZW51ID0gKCkgPT4ge1xuICAgICAgICBsZXQgYXJyID0gW107XG4gICAgICAgIGFyciA9IHNlcnZpY2VzLm1hcCgoc2VydmljZSkgPT4ge1xuICAgICAgICAgICAgcmV0dXJuIDxNZW51Lkl0ZW0ga2V5PXtzZXJ2aWNlLm5hbWV9PntzZXJ2aWNlLnRpdGxlfTwvTWVudS5JdGVtPjtcbiAgICAgICAgfSk7XG4gICAgICAgIHJldHVybiBhcnI7XG4gICAgfTtcblxuICAgIC8vIGhhbmRsZSBtb2RhbC9wYWdlIG9wZW4gcmVxdWVzdCBvbiBjcmVhdGUvYWRkIGVudGl0eSBidXR0b25cbiAgICBjb25zdCBoYW5kbGVSZXF1ZXN0T3BlbiA9IChzZXJ2aWNlTmFtZSwgc2VydmljZVRpdGxlKSA9PiB7XG4gICAgICAgIGNvbnN0IGlzSW5wdXRQYWdlU3R5bGUgPSBzZXJ2aWNlcy5maW5kKCh4KSA9PiB4Lm5hbWUgPT09IHNlcnZpY2VOYW1lKS5zdHlsZSA9PT0gU1RZTEVfUEFHRTtcblxuICAgICAgICBzZXRFbnRpdHkoe1xuICAgICAgICAgICAgLi4uZW50aXR5LFxuICAgICAgICAgICAgb3BlbjogdHJ1ZSxcbiAgICAgICAgICAgIHNlcnZpY2VOYW1lLFxuICAgICAgICAgICAgbW9kZTogTU9ERV9DUkVBVEUsXG4gICAgICAgICAgICBmb3JtTGFiZWw6IGBBZGQgJHtzZXJ2aWNlVGl0bGV9YCxcbiAgICAgICAgICAgIGlzSW5wdXRQYWdlU3R5bGUsXG4gICAgICAgIH0pO1xuICAgICAgICBpZiAoaXNJbnB1dFBhZ2VTdHlsZSkge1xuICAgICAgICAgICAgLy8gc2V0IHF1ZXJ5IGFuZCBwdXNoIHRvIGhpc3RvcnlcbiAgICAgICAgICAgIHF1ZXJ5LnNldCgnc2VydmljZScsIHNlcnZpY2VOYW1lKTtcbiAgICAgICAgICAgIHF1ZXJ5LnNldCgnYWN0aW9uJywgTU9ERV9DUkVBVEUpO1xuICAgICAgICAgICAgaGlzdG9yeS5wdXNoKHsgc2VhcmNoOiBxdWVyeS50b1N0cmluZygpIH0pO1xuICAgICAgICB9XG4gICAgfTtcblxuICAgIC8vIGhhbmRsZSBjbG9zZS9jYW5jZWwvYmFjayByZXF1ZXN0IGluIGFkZC9jcmVhdGUgbW9kYWwgY29tcG9uZW50XG4gICAgY29uc3QgaGFuZGxlTW9kYWxEaWFsb2dDbG9zZSA9ICgpID0+IHtcbiAgICAgICAgc2V0RW50aXR5KHsgLi4uZW50aXR5LCBvcGVuOiBmYWxzZSB9KTtcbiAgICB9O1xuXG4gICAgLy8gZ2VuZXJhdGUgbW9kYWwgc3R5bGUgZGlhbG9nXG4gICAgY29uc3QgZ2VuZXJhdGVNb2RhbERpYWxvZyA9ICgpID0+IHtcbiAgICAgICAgcmV0dXJuIChcbiAgICAgICAgICAgIDxFbnRpdHlNb2RhbFxuICAgICAgICAgICAgICAgIHBhZ2U9e1BBR0VfSU5QVVR9XG4gICAgICAgICAgICAgICAgb3Blbj17ZW50aXR5Lm9wZW59XG4gICAgICAgICAgICAgICAgaGFuZGxlUmVxdWVzdENsb3NlPXtoYW5kbGVNb2RhbERpYWxvZ0Nsb3NlfVxuICAgICAgICAgICAgICAgIHNlcnZpY2VOYW1lPXtlbnRpdHkuc2VydmljZU5hbWV9XG4gICAgICAgICAgICAgICAgbW9kZT17TU9ERV9DUkVBVEV9XG4gICAgICAgICAgICAgICAgZm9ybUxhYmVsPXtlbnRpdHkuZm9ybUxhYmVsfVxuICAgICAgICAgICAgLz5cbiAgICAgICAgKTtcbiAgICB9O1xuXG4gICAgLy8gaGFuZGxlIGNsb25lL2VkaXQgcmVxdWVzdCBwZXIgcm93IGZyb20gdGFibGUgZm9yIHBhZ2Ugc3R5bGUgZGlhbG9nXG4gICAgY29uc3QgaGFuZGxlT3BlblBhZ2VTdHlsZURpYWxvZyA9IChyb3csIG1vZGUpID0+IHtcbiAgICAgICAgY29uc3QgbGFiZWwgPSBzZXJ2aWNlcy5maW5kKCh4KSA9PiB4Lm5hbWUgPT09IHJvdy5zZXJ2aWNlTmFtZSk/LnRpdGxlO1xuICAgICAgICBzZXRFbnRpdHkoe1xuICAgICAgICAgICAgLi4uZW50aXR5LFxuICAgICAgICAgICAgb3BlbjogdHJ1ZSxcbiAgICAgICAgICAgIGlzSW5wdXRQYWdlU3R5bGU6IHRydWUsXG4gICAgICAgICAgICBzZXJ2aWNlTmFtZTogcm93LnNlcnZpY2VOYW1lLFxuICAgICAgICAgICAgc3RhbnphTmFtZTogcm93Lm5hbWUsXG4gICAgICAgICAgICBmb3JtTGFiZWw6IG1vZGUgPT09IE1PREVfQ0xPTkUgPyBgQ2xvbmUgJHtsYWJlbH1gIDogYFVwZGF0ZSAke2xhYmVsfWAsXG4gICAgICAgICAgICBtb2RlLFxuICAgICAgICB9KTtcbiAgICAgICAgLy8gc2V0IHF1ZXJ5IGFuZCBwdXNoIHRvIGhpc3RvcnlcbiAgICAgICAgcXVlcnkuc2V0KCdzZXJ2aWNlJywgcm93LnNlcnZpY2VOYW1lKTtcbiAgICAgICAgcXVlcnkuc2V0KCdhY3Rpb24nLCBtb2RlKTtcbiAgICAgICAgaGlzdG9yeS5wdXNoKHsgc2VhcmNoOiBxdWVyeS50b1N0cmluZygpIH0pO1xuICAgIH07XG5cbiAgICAvLyBoYW5kbGUgY2xvc2UgcmVxdWVzdCBmb3IgcGFnZSBzdHlsZSBkaWFsb2dcbiAgICBjb25zdCBoYW5kbGVQYWdlRGlhbG9nQ2xvc2UgPSAoKSA9PiB7XG4gICAgICAgIHNldEVudGl0eSh7IC4uLmVudGl0eSwgb3BlbjogZmFsc2UgfSk7XG4gICAgICAgIHF1ZXJ5LmRlbGV0ZSgnYWN0aW9uJyk7XG4gICAgICAgIGhpc3RvcnkucHVzaCh7IHNlYXJjaDogcXVlcnkudG9TdHJpbmcoKSB9KTtcbiAgICB9O1xuXG4gICAgLy8gZ2VuZXJhdGUgcGFnZSBzdHlsZSBkaWFsb2dcbiAgICBjb25zdCBnZW5lcmF0ZVBhZ2VEaWFsb2cgPSAoKSA9PiB7XG4gICAgICAgIHJldHVybiAoXG4gICAgICAgICAgICA8RW50aXR5UGFnZVxuICAgICAgICAgICAgICAgIG9wZW49e2VudGl0eS5vcGVufVxuICAgICAgICAgICAgICAgIGhhbmRsZVJlcXVlc3RDbG9zZT17aGFuZGxlUGFnZURpYWxvZ0Nsb3NlfVxuICAgICAgICAgICAgICAgIHNlcnZpY2VOYW1lPXtlbnRpdHkuc2VydmljZU5hbWV9XG4gICAgICAgICAgICAgICAgc3RhbnphTmFtZT17ZW50aXR5LnN0YW56YU5hbWV9XG4gICAgICAgICAgICAgICAgbW9kZT17ZW50aXR5Lm1vZGV9XG4gICAgICAgICAgICAgICAgZm9ybUxhYmVsPXtlbnRpdHkuZm9ybUxhYmVsfVxuICAgICAgICAgICAgLz5cbiAgICAgICAgKTtcbiAgICB9O1xuXG4gICAgY29uc3QgaGFuZGxlQ2hhbmdlQ3VzdG9tTWVudSA9ICh2YWwpID0+IHtcbiAgICAgICAgY29uc3QgeyBzZXJ2aWNlIH0gPSB2YWw7XG4gICAgICAgIGhhbmRsZVJlcXVlc3RPcGVuKHNlcnZpY2UsIHNlcnZpY2VzLmZpbmQoKHgpID0+IHgubmFtZSA9PT0gc2VydmljZSkudGl0bGUpO1xuICAgIH07XG5cbiAgICBjb25zdCBvblRhYkNoYW5nZSA9IHVzZUNhbGxiYWNrKChlLCB7IHNlbGVjdGVkVGFiSWQgfSkgPT4ge1xuICAgICAgICBzZXRBY3RpdmVUYWJJZChzZWxlY3RlZFRhYklkKTtcblxuICAgICAgICBjb25zdCBzZWxlY3RlZFRhYkluZm8gPSBzZXJ2aWNlcy5maW5kKChzZXJ2aWNlKSA9PiBzZXJ2aWNlLm5hbWUgPT09IHNlbGVjdGVkVGFiSWQpO1xuICAgICAgICBpZiAoc2VsZWN0ZWRUYWJJbmZvKSB7XG4gICAgICAgICAgICBzZXRTZWxlY3RlZFRhYkRlc2NyaXB0aW9uKHNlbGVjdGVkVGFiSW5mby5kZXNjcmlwdGlvbik7XG4gICAgICAgICAgICBzZXRTZWxlY3RlZFRhYlRpdGxlKHNlbGVjdGVkVGFiSW5mby50aXRsZSk7XG4gICAgICAgIH1cblxuICAgICAgICBxdWVyeS5zZXQoJ3NlcnZpY2UnLCBzZWxlY3RlZFRhYklkKTtcbiAgICAgICAgcXVlcnkuZGVsZXRlKCdhY3Rpb24nKTtcbiAgICAgICAgaGlzdG9yeS5wdXNoKHsgc2VhcmNoOiBxdWVyeS50b1N0cmluZygpIH0pO1xuXG4gICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIHJlYWN0LWhvb2tzL2V4aGF1c3RpdmUtZGVwc1xuICAgIH0sIFthY3RpdmVUYWJJZF0pO1xuXG4gICAgLy8gTWFraW5nIGEgZHJvcGRvd24gaWYgd2UgaGF2ZSBtb3JlIHRoYW4gb25lIHNlcnZpY2VcbiAgICBjb25zdCBtYWtlU2luZ2xlU2VsZWN0RHJvcERvd24gPSAoKSA9PiB7XG4gICAgICAgIHJldHVybiAoXG4gICAgICAgICAgICA8Q29sdW1uTGF5b3V0LkNvbHVtbiBjbGFzc05hbWU9XCJkcm9wZG93blwiIHNwYW49ezN9PlxuICAgICAgICAgICAgICAgIDxEcm9wZG93biB0b2dnbGU9e3RvZ2dsZX0+XG4gICAgICAgICAgICAgICAgICAgIDxNZW51XG4gICAgICAgICAgICAgICAgICAgICAgICBvbkNsaWNrPXsoZXZlbnQpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBmaW5kbmFtZSA9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlcnZpY2VzW1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VydmljZXMuZmluZEluZGV4KFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICh4KSA9PlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB4LnRpdGxlID09PSBldmVudC50YXJnZXQuaW5uZXJUZXh0XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICApXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIF0ubmFtZTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBoYW5kbGVSZXF1ZXN0T3BlbihmaW5kbmFtZSwgZXZlbnQudGFyZ2V0LmlubmVyVGV4dCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9fVxuICAgICAgICAgICAgICAgICAgICA+XG4gICAgICAgICAgICAgICAgICAgICAgICB7Z2V0SW5wdXRNZW51KCl9XG4gICAgICAgICAgICAgICAgICAgIDwvTWVudT5cbiAgICAgICAgICAgICAgICA8L0Ryb3Bkb3duPlxuICAgICAgICAgICAgPC9Db2x1bW5MYXlvdXQuQ29sdW1uPlxuICAgICAgICApXG4gICAgfVxuXG4gICAgLy8gTWFraW5nIGEgZHJvcGRvd24gaWYgd2UgaGF2ZSBvbmUgc2VydmljZVxuICAgIGNvbnN0IG1ha2VJbnB1dEJ1dHRvbiA9ICgpID0+IHtcbiAgICAgICAgcmV0dXJuIChcbiAgICAgICAgICAgIDxDb2x1bW5MYXlvdXQuQ29sdW1uIHNwYW49ezN9IGNsYXNzTmFtZT1cImlucHV0X2J1dHRvblwiPlxuICAgICAgICAgICAgICAgIDxCdXR0b25cbiAgICAgICAgICAgICAgICAgICAgbGFiZWw9e2dldEZvcm1hdHRlZE1lc3NhZ2UoMTAwKX1cbiAgICAgICAgICAgICAgICAgICAgYXBwZWFyYW5jZT1cInByaW1hcnlcIlxuICAgICAgICAgICAgICAgICAgICBpZD1cImFkZElucHV0QnRuXCJcbiAgICAgICAgICAgICAgICAgICAgb25DbGljaz17KCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgaGFuZGxlUmVxdWVzdE9wZW4oc2VydmljZXNbMF0ubmFtZSwgc2VydmljZXNbMF0udGl0bGUpO1xuICAgICAgICAgICAgICAgICAgICB9fVxuICAgICAgICAgICAgICAgIC8+XG4gICAgICAgICAgICA8L0NvbHVtbkxheW91dC5Db2x1bW4+XG4gICAgICAgIClcbiAgICB9XG5cbiAgICAvLyBNYWtpbmcgYSBjdXN0b20gbWVudVxuICAgIGNvbnN0IG1ha2VDdXN0b21NZW51ID0gKCkgPT4ge1xuICAgICAgICByZXR1cm4gKFxuICAgICAgICAgICAgPENvbHVtbkxheW91dC5Db2x1bW4gc3Bhbj17M30gY2xhc3NOYW1lPVwiaW5wdXRfYnV0dG9uXCI+XG4gICAgICAgICAgICAgICAge1JlYWN0LmNyZWF0ZUVsZW1lbnQoQ3VzdG9tTWVudSwge1xuICAgICAgICAgICAgICAgICAgICBmaWxlTmFtZTogY3VzdG9tTWVudUZpZWxkLnNyYyxcbiAgICAgICAgICAgICAgICAgICAgdHlwZTogY3VzdG9tTWVudUZpZWxkLnR5cGUsXG4gICAgICAgICAgICAgICAgICAgIGhhbmRsZUNoYW5nZTogaGFuZGxlQ2hhbmdlQ3VzdG9tTWVudVxuICAgICAgICAgICAgICAgIH0pfVxuICAgICAgICAgICAgPC9Db2x1bW5MYXlvdXQuQ29sdW1uPlxuICAgICAgICApXG4gICAgfVxuXG4gICAgcmV0dXJuIChcbiAgICAgICAgPEVycm9yQm91bmRhcnk+XG4gICAgICAgICAgICA8VGFibGVDb250ZXh0UHJvdmlkZXIgdmFsdWU9e251bGx9PlxuICAgICAgICAgICAgICAgIHtlbnRpdHkuaXNJbnB1dFBhZ2VTdHlsZSAmJiBlbnRpdHkub3BlbiA/IGdlbmVyYXRlUGFnZURpYWxvZygpIDogbnVsbH17JyAnfVxuICAgICAgICAgICAgICAgIDxkaXZcbiAgICAgICAgICAgICAgICAgICAgc3R5bGU9e1xuICAgICAgICAgICAgICAgICAgICAgICAgZW50aXR5LmlzSW5wdXRQYWdlU3R5bGUgJiYgZW50aXR5Lm9wZW5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICA/IHsgZGlzcGxheTogJ25vbmUnIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICA6IHsgZGlzcGxheTogJ2Jsb2NrJyB9XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICA+XG4gICAgICAgICAgICAgICAgICAgIDxDb2x1bW5MYXlvdXQgZ3V0dGVyPXs4fT5cbiAgICAgICAgICAgICAgICAgICAgICAgIDxSb3c+XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgPENvbHVtbkxheW91dC5Db2x1bW4gc3Bhbj17OX0+XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxUaXRsZUNvbXBvbmVudD57IGlzT3V0ZXJUYWJsZSA/IF8odGl0bGUgfHwgXCJcIikgOiBfKHNlbGVjdGVkVGFiVGl0bGUpIH08L1RpdGxlQ29tcG9uZW50PlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8U3ViVGl0bGVDb21wb25lbnQ+eyBpc091dGVyVGFibGUgPyBfKGRlc2NyaXB0aW9uIHx8IFwiXCIpIDogIF8oc2VsZWN0ZWRUYWJEZXNjcmlwdGlvbiB8fCAnJykgfTwvU3ViVGl0bGVDb21wb25lbnQ+XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9Db2x1bW5MYXlvdXQuQ29sdW1uPlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaXNPdXRlclRhYmxlID8gKFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKHNlcnZpY2VzICYmICFjdXN0b21NZW51RmllbGQ/LnNyYykgP1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKChzZXJ2aWNlcy5sZW5ndGggPiAxKSA/IG1ha2VTaW5nbGVTZWxlY3REcm9wRG93bigpIDogbWFrZUlucHV0QnV0dG9uKCkpIDpcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1ha2VDdXN0b21NZW51KClcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKSA6IG51bGxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICA8L1Jvdz5cbiAgICAgICAgICAgICAgICAgICAgPC9Db2x1bW5MYXlvdXQ+XG4gICAgICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlzT3V0ZXJUYWJsZSA/IChcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8VGFibGVXcmFwcGVyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhZ2U9e1BBR0VfSU5QVVR9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGhhbmRsZU9wZW5QYWdlU3R5bGVEaWFsb2c9e2hhbmRsZU9wZW5QYWdlU3R5bGVEaWFsb2d9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLz5cbiAgICAgICAgICAgICAgICAgICAgICAgICkgOiAoXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgPD5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPFRhYkJhciBhY3RpdmVUYWJJZD17YWN0aXZlVGFiSWR9IG9uQ2hhbmdlPXtvblRhYkNoYW5nZX0+XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB7c2VydmljZXMubWFwKChzZXJ2aWNlKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICg8VGFiQmFyLlRhYiBrZXk9e3NlcnZpY2UubmFtZX0gbGFiZWw9e18oc2VydmljZS50aXRsZSl9IHRhYklkPXtzZXJ2aWNlLm5hbWV9PiA8L1RhYkJhci5UYWI+KVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSl9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvVGFiQmFyPlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZXJ2aWNlcy5tYXAoKHNlcnZpY2UpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gKFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBrZXk9e3NlcnZpY2UubmFtZX1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0eWxlPXtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZXJ2aWNlLm5hbWUgIT09IGFjdGl2ZVRhYklkID8geyBkaXNwbGF5OiAnbm9uZScgfSA6IHsgZGlzcGxheTogJ2Jsb2NrJyB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZD17YCR7c2VydmljZS5uYW1lfVRhYmB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgID5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxUYWJsZVdyYXBwZXJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYWdlPXtQQUdFX0lOUFVUfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlcnZpY2VOYW1lPXtzZXJ2aWNlLm5hbWV9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaGFuZGxlUmVxdWVzdE1vZGFsT3Blbj17KCkgPT4gaGFuZGxlUmVxdWVzdE9wZW4oc2VydmljZS5uYW1lLCBzZXJ2aWNlLnRpdGxlKX1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBoYW5kbGVPcGVuUGFnZVN0eWxlRGlhbG9nPXtoYW5kbGVPcGVuUGFnZVN0eWxlRGlhbG9nfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLz5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvPlxuICAgICAgICAgICAgICAgICAgICAgICAgKVxuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgPFRvYXN0TWVzc2FnZXMgcG9zaXRpb249XCJ0b3AtcmlnaHRcIiAvPlxuICAgICAgICAgICAgICAgICAgICB7IWVudGl0eS5pc0lucHV0UGFnZVN0eWxlICYmIGVudGl0eS5vcGVuID8gZ2VuZXJhdGVNb2RhbERpYWxvZygpIDogbnVsbH1cbiAgICAgICAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgICAgIDwvVGFibGVDb250ZXh0UHJvdmlkZXI+XG4gICAgICAgIDwvRXJyb3JCb3VuZGFyeT5cbiAgICApO1xufVxuXG5leHBvcnQgZGVmYXVsdCBJbnB1dFBhZ2U7XG4iXSwic291cmNlUm9vdCI6IiJ9