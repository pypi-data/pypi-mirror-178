(self.webpackChunkPaddleLabel_Frontend=self.webpackChunkPaddleLabel_Frontend||[]).push([[672],{73199:function(){},29214:function(se,U,n){"use strict";n.r(U);var I=n(39428),Z=n(11849),ie=n(20228),x=n(11382),S=n(91220),N=n(34792),f=n(48086),R=n(86582),b=n(3182),T=n(2824),a=n(67294),Q=n(48971),ce=n(73199),de=n.n(ce),j=n(51505),ue=n(8088),g=n(61541),X=n(44434),_e=n(5041),ve=n(57436),fe=n(10137),z=n(83721),me=n(36505),Pe=n(84420),ge=n.n(Pe),Ee=n(27992),pe=window.location.port=="8000"?"1234":window.location.port,he="http://".concat(window.location.hostname,":").concat(pe,"/"),Le=function(){var H,E=(0,a.useRef)(null),F=(0,z.Ad)("pages.classification"),d=(0,me.I)("pages.toolBar"),De=(0,a.useState)(!1),Y=(0,T.Z)(De,2),C=Y[0],V=Y[1],Ce=(0,a.useState)(!0),q=(0,T.Z)(Ce,2),K=q[0],ee=q[1],Me=(0,a.useState)(),te=(0,T.Z)(Me,2),i=te[0],Oe=te[1],ne=(0,Q.tT)("InteractorData"),p=ne.interactorData,Ie=ne.setInteractorData,Se=(0,a.useState)(50),ae=(0,T.Z)(Se,2),$=ae[0],be=ae[1],v=(0,z.$L)(a.useState,a.useEffect,{label:{oneHot:!1,postSelect:Re},tool:{defaultTool:"mover"},effectTrigger:{postTaskChange:je,postProjectChanged:Ue}}),G=v.tool,w=v.loading,W=v.scale,h=v.annotation,A=v.task,m=v.data,u=v.project,s=v.label,Te=v.refreshVar,Ae=ge()(m.imgSrc||"","anonymous"),Be=(0,T.Z)(Ae,1),k=Be[0],P=(0,z.RZ)(a.useState,he);function Ue(){var t;((t=u.curr)===null||t===void 0?void 0:t.labelFormat)=="single_class"&&s.setOneHot(!0)}var Ze=function(e){if(console.log("getBase64Image",e),!e)return"";var r=document.createElement("canvas");r.width=e.width,r.height=e.height,console.log("img.width",e.width);var l=r.getContext("2d");l==null||l.drawImage(e,0,0,e.width,e.height);var o=r.toDataURL("image/png");return console.log("dataURL",o),o.replace(/^data:image\/(png|jpg);base64,/,"")};function Re(t,e){return J.apply(this,arguments)}function J(){return J=(0,b.Z)((0,I.Z)().mark(function t(e,r){var l,o,L,M;return(0,I.Z)().wrap(function(O){for(;;)switch(O.prev=O.next){case 0:if(console.log("+_+_+",e,r,r.has(e.labelId)),r.has(e.labelId))console.log("+_+_+_","here"),s.isOneHot&&h.all.map(function(_){return h.remove(_)}),h.create({taskId:A.curr.taskId,labelId:e.labelId,dataId:m.curr.dataId}).then(function(){return f.default.success(d("saveSuccess"))});else{l=h.all.filter(function(_){return _.labelId==e.labelId}),o=(0,S.Z)(l);try{for(o.s();!(L=o.n()).done;)M=L.value,h.remove(M.annotationId)}catch(_){o.e(_)}finally{o.f()}}case 2:case"end":return O.stop()}},t)})),J.apply(this,arguments)}function je(t,e){w.setCurr(!0),!(!t||!e)&&(s.initActive(e),w.setCurr(!1),console.log("post task change"))}var oe=function(e){var r=Ze(e),l=P.predict("PPLCNetV2",{format:"b64",img:r});!l||l.then(function(o){if(o){console.log("resss",o);var L=o==null?void 0:o.predictions;V(!1),m.updatePredicted(m.all[0].dataId,!0),Ie({active:!0,mousePoints:p.mousePoints,predictData:L})}},function(o){P.setLoading(!1),console.log("line.error",o)})},Ke=function(e){var r=(0,R.Z)(e).map(function(l){var o={name:l,projectId:u.curr.projectId};return o});r.length>0&&s.create(r).then(function(l){l==null||l.forEach(function(o){s.onSelect(o)})})};return(0,j.Z)(function(){if(m.all.length>0)if(m.all[0].predicted){var t=!1;t!==C&&V(t)}else{var e=!0;e!==C&&V(e)}},[m.all]),(0,j.Z)(function(){var t,e;if(C&&(t=u.curr)!==null&&t!==void 0&&(e=t.otherSettings)!==null&&e!==void 0&&e.labelMapping){var r;if(P.loading){f.default.error(d("modelLoading"));return}var l=(r=u.curr)!==null&&r!==void 0&&r.otherSettings?u.curr.otherSettings:{};P.setMlBackendUrl(l.mlBackendUrl||""),P.setLoading(!0),P.load(l.modelName).then(function(){P.setLoading(!1),K&&ee(!1)},function(){P.setLoading(!1),K||ee(!0)})}else{var o;Oe((o=u.curr)===null||o===void 0?void 0:o.otherSettings)}},[C,(H=u.curr)===null||H===void 0?void 0:H.otherSettings]),(0,j.Z)(function(){var t=!K&&k&&C;t&&oe(k)},[K,C,k]),(0,j.Z)(function(){if(console.log("interactorData.predictData",i,p.predictData.length),p.predictData.length&&i!==null&&i!==void 0&&i.labelMapping&&s.all){var t,e=new Set,r=new Map,l={},o=(0,S.Z)(s.all),L;try{for(o.s();!(L=o.n()).done;){var M=L.value;M.name&&r.set(M.name,M)}}catch(D){o.e(D)}finally{o.f()}if((i==null||(t=i.labelMapping)===null||t===void 0?void 0:t.length)>0){var B=(0,S.Z)(i==null?void 0:i.labelMapping),O;try{for(B.s();!(O=B.n()).done;){var _=O.value;l[_.model]=_.project,r.has(_.project)||e.add(_.project)}}catch(D){B.e(D)}finally{B.f()}}var re=$?$*.01:.5,y=(0,S.Z)(p.predictData),le;try{for(y.s();!(le=y.n()).done;){var c=le.value;(c==null?void 0:c.score)>re&&(console.log("!oldLabel.has(labelItem?.label_name)",r),c&&!r.has(c==null?void 0:c.label_name)&&!l[c==null?void 0:c.label_name]&&e.add(c==null?void 0:c.label_name))}}catch(D){y.e(D)}finally{y.f()}var We=p.predictData.some(function(D){return D.score>re});We||f.default.error(F("noHighScoreResult")),Ke(e),!(0,R.Z)(e).length}},[p,i]),console.log("label.activeIds",s.activeIds.size),a.createElement(ue.Z,{className:de().classes},a.createElement(X.Z,null,a.createElement(g.Z,{imgSrc:"./pics/buttons/zoom_in.png",onClick:function(){W.change(.1)}},d("zoomIn")),a.createElement(g.Z,{imgSrc:"./pics/buttons/zoom_out.png",onClick:function(){W.change(-.1)}},d("zoomOut")),a.createElement(g.Z,{imgSrc:"./pics/buttons/save.png",onClick:function(){f.default.success(d("autoSave"))}},d("save")),a.createElement(g.Z,{imgSrc:"./pics/buttons/move.png",active:G.curr=="mover",onClick:function(){G.setCurr("mover")}},d("move")),a.createElement(g.Z,{imgSrc:"./pics/buttons/clear_mark.png",onClick:function(){h.clear()}},d("clearMark"))),a.createElement("div",{id:"dr",className:"mainStage"},a.createElement(x.Z,{tip:d("loading","global"),spinning:w.curr},a.createElement("div",{className:"draw"},a.createElement(ve.Z,{ref:E,scale:W.curr,currentTool:G.curr,scaleChange:W.setScale,taskIndex:A.currIdx,setCurrentAnnotation:function(){},onAnnotationModify:function(){},onAnnotationModifyComplete:function(){},imgSrc:m.imgSrc,annotations:h.all})),a.createElement("div",{className:"pblock"},a.createElement(fe.Z,{task:A,project:u})),a.createElement("div",{className:"prevTask",onClick:function(){var e;s.activeIds.size||f.default.info(F("preNext")),A.prevTask(),E==null||(e=E.current)===null||e===void 0||e.setDragEndPos({x:0,y:0})},"data-test-id":"prevTask"}),a.createElement("div",{className:"nextTask",onClick:function(){var e;s.activeIds.size||f.default.info(F("preNext")),A.nextTask(),E==null||(e=E.current)===null||e===void 0||e.setDragEndPos({x:0,y:0})},"data-test-id":"nextTask"}))),a.createElement(X.Z,{disLoc:"right"},a.createElement(g.Z,{imgSrc:"./pics/buttons/data_division.png",onClick:function(){Q.m8.push("/project_overview?projectId=".concat(u.curr.projectId))}},d("projectOverview")),a.createElement(g.Z,{imgSrc:"./pics/buttons/intelligent_interaction.png",disabled:!(i!=null&&i.labelMapping),onClick:function(){oe(k)}},d("autoInference")),a.createElement(Ee.Z,{disabled:!p.active,imgSrc:"./pics/buttons/threshold.png",disLoc:"left",size:$,maxSize:100,minSize:10,step:10,onChange:function(e){be(e)}},d("autoInferenceThreshold"))),a.createElement("div",{className:"rightSideBar"},a.createElement(_e.Z,{labels:s.all,activeIds:s.activeIds,onLabelSelect:s.onSelect,onLabelAdd:function(e){return s.create((0,Z.Z)((0,Z.Z)({},e),{},{projectId:u.curr.projectId}))},onLabelDelete:s.remove,hideColorPicker:!0,hideEye:!0,refresh:Te})))};U.default=Le},51505:function(se,U,n){"use strict";n.d(U,{Z:function(){return x}});var I=n(67294),Z=function(N){return function(f,R){var b=(0,I.useRef)(!1);N(function(){return function(){b.current=!1}},[]),N(function(){if(!b.current)b.current=!0;else return f()},R)}},ie=null,x=Z(I.useEffect)}}]);
