(self.webpackChunkPaddleLabel_Frontend=self.webpackChunkPaddleLabel_Frontend||[]).push([[540],{13237:function(le){le.exports={toolBarButtonContainerWrapper:"toolBarButtonContainerWrapper___26yoA",toolBarButtonContainer:"toolBarButtonContainer___3TAcy",toolBarButton:"toolBarButton___utzQD",buttonText:"buttonText___10yo3",toolBarButtonContainerWrapperActive:"toolBarButtonContainerWrapperActive___UC85Z",popover:"popover___V2uUa",slider:"slider___293AL",popoverLeft:"popoverLeft___2uQ3J"}},92005:function(le){le.exports={toolBarButtonContainerWrapper:"toolBarButtonContainerWrapper___lgjXv",toolBarButtonContainer:"toolBarButtonContainer___9-mqN",toolBarButton:"toolBarButton___3mwy2",buttonText:"buttonText___2t3jE",toolBarButtonContainerWrapperActive:"toolBarButtonContainerWrapperActive___3k6_F",popover:"popover___2HFqy",slider:"slider___2R_WW",popoverLeft:"popoverLeft___XK8Bw"}},39565:function(le,Ze,h){"use strict";h.r(Ze),h.d(Ze,{default:function(){return Nn}});var vt=h(57663),ie=h(71577),K=h(39428),me=h(3182),ft=h(20228),en=h(11382),gt=h(34792),q=h(48086),_=h(91220),w=h(11849),O=h(2824),o=h(67294),U=h(48971),nn=h(8088),$=h(61541),Be=h(44434),ee=h(27992),mt=h(20136),Te=h(19181),ht=h(13062),tn=h(71230),bt=h(89032),on=h(15746),St=h(43358),Fe=h(42239),Le=h(36505),rn=h(92005),ke=h.n(rn),an=0,ln=100,un=10,Oe=Fe.Z.Option,dn=function(n){var a=(0,Le.I)("pages.toolBar.colorMode"),l=(0,o.useState)(u(n.size)),t=(0,O.Z)(l,2),v=t[0],d=t[1];function c(f){d(u(f))}console.log(v);var s=n.minSize==null?an:n.minSize,i=n.maxSize==null?ln:n.maxSize;function u(f){return f==null?un:f<=s?s:f>=i?i:f}return(0,o.useEffect)(function(){c(n.size)},[n.size]),o.createElement(Te.Z,{overlayClassName:"".concat(ke().popover," ").concat(n.disLoc=="left"?ke().popoverLeft:""),placement:n.disLoc||"right",content:o.createElement(tn.Z,null,o.createElement(on.Z,{span:24},o.createElement("div",{style:{padding:"10px"}},o.createElement(Fe.Z,{defaultValue:"label",style:{width:120},onChange:n.onChange},o.createElement(Oe,{value:"label"},a("label")),o.createElement(Oe,{value:"inStance"},a("object")))))),trigger:"hover",visible:n.disabled?!1:void 0}," ",o.createElement($.Z,{imgSrc:n.imgSrc||"",onClick:!n.disabled&&n.onClick||void 0,active:n.active,disabled:n.disabled},n.children))},cn=dn,sn=h(5041),vn=h(57436),Re=h(14836);function fn(e){if(!e||!e.width||!e.color||!e.points||e.points.length<2||e.frontendId==null)return"";var n=e.type=="rubber"?0:e.frontendId;return"".concat(e.width,",").concat(n,",").concat(e.points.join(","))}var he=!1,ne="";function gn(e,n){var a;console.log("flag",n);var l=e.canvasRef2,t=e.annotation,v=l,d=t.result;if(!d)return o.createElement(o.Fragment,null);var c=(a=v.current)===null||a===void 0?void 0:a.getContext("2d");if(!c)return o.createElement(o.Fragment,null);console.log("PPBrush.drawAnnotation, result:",d);var s=[],i=0;console.log("annotation.result",t,e.currentAnnotation);for(var u=0;u<d.length;u++)d.at(u)==","?(s.push(parseFloat(d.slice(i,u))),i=u+1):d.at(u)=="|"?(s.push(parseFloat(d.slice(i,u))),ze(s,c,t),s=[],i=u+1):u==d.length-1&&(s.push(parseFloat(d.slice(i,d.length))),ze(s,c,t));return console.log("annotation param.currentAnnotation brush",he,e.currentTool,n),o.createElement(o.Fragment,null)}var mn=function(n,a,l,t){l.save(),l.beginPath(),console.log("Brushs",n,a),l==null||l.arc(n,a,t/16,0,2*Math.PI),l.strokeStyle="red",l.stroke()};function ze(e,n,a){var l;if(console.log("points",e),e.length<4){console.log("found incorrect points:",e);return}var t=e[0],v=e[1];if(t==0){var d;hn(n,e.slice(2),(d=a.label)===null||d===void 0?void 0:d.color);return}if(v==0){De(n,t,e.slice(2),void 0);return}De(n,t,e.slice(2),(l=a.label)===null||l===void 0?void 0:l.color)}function De(e,n,a,l){e.beginPath(),e.moveTo(a[0],a[1]);for(var t=0;t<=a.length/2-1;t++){var v=a[2*t],d=a[2*t+1];e.lineTo(v,d)}e.lineCap="round",e.lineJoin="round",e.lineWidth=n,l&&(e.strokeStyle=l),e.globalCompositeOperation=l?"source-over":"destination-out",e.stroke()}function hn(e,n,a){console.log("renderPixel: ",n,a,e),e.globalCompositeOperation=a?"source-over":"destination-out",a&&(e.fillStyle=a);for(var l=0;l<=n.length/2-1;l++){var t=n[2*l],v=n[2*l+1];e.fillRect(t,v,1,1)}}function ue(e){if(!e||e.length==0)return 0;var n=0,a=(0,_.Z)(e),l;try{for(a.s();!(l=a.n()).done;){var t=l.value;t.frontendId>n&&(n=t.frontendId)}}catch(v){a.e(v)}finally{a.f()}return n}function bn(e,n){return e=="rubber"||n==2?"rubber":"brush"}function Sn(e){var n=(0,o.useState)(),a=(0,O.Z)(n,2),l=a[0],t=a[1],v=function(i){var u,f,C,S;if(he=!0,!(e.currentTool!="brush"&&e.currentTool!="rubber"||!((u=e.currentLabel)!==null&&u!==void 0&&u.color)||!e.brushSize)){var I=i.mouseX,Z=i.mouseY,F=bn(e.currentTool,i.e.evt.button);console.log("frontendId: ",e.frontendIdOps.frontendId,"maxId:",ue(e.annotations));var E;if(console.log("props.finlyList",e.finlyList,e.selectFinly,U.m8===null||U.m8===void 0||(f=U.m8.location)===null||f===void 0?void 0:f.pathname),(U.m8===null||U.m8===void 0||(C=U.m8.location)===null||C===void 0?void 0:C.pathname)==="/instance_segmentation"){var k,T,j;if(e.finlyList&&((k=e.finlyList)===null||k===void 0?void 0:k.length)>0&&e.selectFinly)E=e.selectFinly.frontendId,console.log("\u6709\u5217\u8868\u957F\u5EA6\u4E14\u6709\u9009\u4E2D",E);else if(e.finlyList&&((T=e.finlyList)===null||T===void 0?void 0:T.length)>0&&!e.selectFinly){var W;E=((W=e.finlyList)===null||W===void 0?void 0:W.length)>0?ue(e.finlyList)+1:1,console.log("\u6709\u5217\u8868\u957F\u5EA6\uFF0C\u65E0\u9009\u4E2D",E)}else((j=e.finlyList)===null||j===void 0?void 0:j.length)===0&&!e.selectFinly&&(E=e.frontendIdOps.frontendId>0?e.frontendIdOps.frontendId:ue(e.annotations)+1,console.log("\u65E0\u5217\u8868\u957F\u5EA6\uFF0C\u65E0\u9009\u4E2D",E))}else E=e.frontendIdOps.frontendId>0?e.frontendIdOps.frontendId:ue(e.annotations)+1;E!=e.frontendIdOps.frontendId&&e.frontendIdOps.setFrontendId(E),console.log("frontendId",E);var V=fn({width:e.brushSize||10,color:((S=e.currentLabel)===null||S===void 0?void 0:S.color)||"blue",points:[I,Z,I,Z],type:F,frontendId:E});if(!!V){if(t(F),e.currentLabel){var oe,ye={dataId:e.dataId,label:e.currentLabel,labelId:(oe=e.currentLabel)===null||oe===void 0?void 0:oe.labelId,frontendId:E,result:V,type:"brush"};e.onAnnotationAdd(ye)}ne=V}}},d=function(i){var u;if(!(!l||!e.currentAnnotation||!e.currentAnnotation.result||e.currentAnnotation.result.length<2||!((u=e.currentLabel)!==null&&u!==void 0&&u.color))){console.log("props.currentAnnotation",e.currentAnnotation,e.annotations);var f=i.mouseX,C=i.mouseY;console.log("mouseX",f,C),ne=ne+",".concat(f,",").concat(C)}},c=function(){var i,u;if(!(!l||!e.currentAnnotation||!e.currentAnnotation.result||e.currentAnnotation.result.length<2||!((i=e.currentLabel)!==null&&i!==void 0&&i.color))){var f=e.annotations[((u=e.annotations)===null||u===void 0?void 0:u.length)-1];e.onAnnotationModify((0,w.Z)((0,w.Z)({},f),{},{result:ne})),ne="",he=!1,t(void 0),e.onMouseUp()}};return{onMouseDown:v,onMouseMove:d,onMouseUp:c,drawGuidewires:mn,drawAnnotation:gn}}function Cn(e){if(!e||!e.width||e.color==null||!e.points||e.points.length<2||e.frontendId==null)return"";var n=e.type=="rubber"?0:e.frontendId;return"".concat(e.width,",").concat(n,",").concat(e.points.join(","))}var be=!1,te="";function In(e,n){var a;console.log("flag",n);var l=e.canvasRef2,t=e.annotation,v=l,d=t.result;if(!d)return o.createElement(o.Fragment,null);var c=(a=v.current)===null||a===void 0?void 0:a.getContext("2d");if(!c)return o.createElement(o.Fragment,null);console.log("PPBrush.drawAnnotation, result:",d);var s=[],i=0;console.log("annotation.result",t,e.currentAnnotation);for(var u=0;u<d.length;u++)d.at(u)==","?(s.push(parseFloat(d.slice(i,u))),i=u+1):d.at(u)=="|"?(s.push(parseFloat(d.slice(i,u))),we(s,c,t),s=[],i=u+1):u==d.length-1&&(s.push(parseFloat(d.slice(i,d.length))),we(s,c,t));return console.log("annotation param.currentAnnotation rubber",be,e.currentTool,n),o.createElement(o.Fragment,null)}function we(e,n,a){var l;if(console.log("points",e),e.length<4){console.log("found incorrect points:",e);return}var t=e[0],v=e[1];if(t==0){var d;yn(n,e.slice(2),(d=a.label)===null||d===void 0?void 0:d.color);return}if(v==0){Ue(n,t,e.slice(2),void 0);return}Ue(n,t,e.slice(2),(l=a.label)===null||l===void 0?void 0:l.color)}function Ue(e,n,a,l){console.log("renderBrush: ",a,n,l,e),e.beginPath(),e.moveTo(a[0],a[1]);for(var t=0;t<=a.length/2-1;t++){var v=a[2*t],d=a[2*t+1];e.lineTo(v,d)}e.lineCap="round",e.lineJoin="round",e.lineWidth=n,e.strokeStyle="",e.globalCompositeOperation=l?"source-over":"destination-out",e.stroke()}function yn(e,n,a){console.log("renderPixel: ",n,a,e),e.globalCompositeOperation=a?"source-over":"destination-out",a&&(e.fillStyle=a);for(var l=0;l<=n.length/2-1;l++){var t=n[2*l],v=n[2*l+1];e.fillRect(t,v,1,1)}}function $e(e){if(!e||e.length==0)return 0;var n=0,a=(0,_.Z)(e),l;try{for(a.s();!(l=a.n()).done;){var t=l.value;t.frontendId>n&&(n=t.frontendId)}}catch(v){a.e(v)}finally{a.f()}return n}function Pn(e,n){return e=="rubber"||n==2?"rubber":"brush"}function An(e){var n=(0,o.useState)(),a=(0,O.Z)(n,2),l=a[0],t=a[1],v=function(i){var u;if(be=!0,!(e.currentTool!="brush"&&e.currentTool!="rubber"||!e.brushSize)){var f=i.mouseX,C=i.mouseY,S=Pn(e.currentTool,i.e.evt.button);console.log("frontendId: ",e.frontendIdOps.frontendId,"maxId:",$e(e.annotations),"tool: ",S);var I=e.frontendIdOps.frontendId>0?e.frontendIdOps.frontendId:$e(e.annotations)+1;I!=e.frontendIdOps.frontendId&&e.frontendIdOps.setFrontendId(I);var Z=Cn({width:e.brushSize||10,color:S==="brush"&&((u=e.currentLabel)===null||u===void 0?void 0:u.color)||"",points:[f,C,f,C],type:S,frontendId:I});if(console.log(Z),t(S),!!Z){if(S==="brush"){if(e.currentLabel){var F,E={dataId:e.dataId,label:e.currentLabel,labelId:(F=e.currentLabel)===null||F===void 0?void 0:F.labelId,frontendId:I,result:Z,type:"brush"};e.onAnnotationAdd(E)}}else{var k,T,j,W={dataId:e.dataId,label:e.currentAnnotation?(k=e.currentAnnotation)===null||k===void 0?void 0:k.label:e.labels[0],labelId:e.currentAnnotation?(T=e.currentAnnotation)===null||T===void 0?void 0:T.labelId:(j=e.labels[0])===null||j===void 0?void 0:j.labelId,frontendId:I,result:Z,type:"rubber"};e.onAnnotationAdd(W)}te=Z}}},d=function(i){if(console.log("currentTool",l),!!l){console.log("props.currentAnnotation",e.currentAnnotation,e.annotations);var u=i.mouseX,f=i.mouseY;console.log("mouseX",u,f),te=te+",".concat(u,",").concat(f)}},c=function(){var i;if(e.currentTool=="rubber"){var u=e.annotations[((i=e.annotations)===null||i===void 0?void 0:i.length)-1];e.onAnnotationModify((0,w.Z)((0,w.Z)({},u),{},{result:te})),te="",be=!1,t(void 0),e.onMouseUp()}};return{onMouseDown:v,onMouseMove:d,onMouseUp:c,drawAnnotation:In}}var Se=h(65031),En=h(57406);function Mn(e,n){if(!(!e||!n))return n.join(",")}function Zn(e,n){var a,l=e.annotation;if(!l||!l.result||l.result.length<2||!((a=l.label)!==null&&a!==void 0&&a.color))return o.createElement(o.Fragment,null);var t=l.result.split(",").map(Number),v=l.label.color,d=(0,En.oo)(v);if(!d)return o.createElement(o.Fragment,null);var c=1,s=void 0,i=[];return t.forEach(function(u,f){if(!s){s=u;return}i.push(o.createElement(Se.Cd,{onMouseDown:function(){e.currentTool=="editor"&&e.onSelect(l)},draggable:e.currentTool=="editor",onDragEnd:function(S){var I;S.cancelBubble=!0;var Z=(I=e.stageRef)===null||I===void 0?void 0:I.current,F=Z.findOne(".baseImage"),E=!1,k=S.target.x();k>F.width()/2&&(k=F.width()/2,E=!0),k<-F.width()/2&&(k=-F.width()/2,E=!0);var T=S.target.y();T>F.height()/2&&(T=F.height()/2,E=!0),T<-F.height()/2&&(T=-F.height()/2,E=!0),E&&S.target.setPosition({x:k,y:T}),console.log("pointsss",t,f,k,T),t[f-1]=k,t[f]=T;var j=(0,w.Z)((0,w.Z)({},l),{},{result:t.join(",")});e.onDragUP(j)},onMouseOver:function(){var S,I,Z;console.log("props.stageRef?.current",e.currentTool,(S=e.stageRef)===null||S===void 0?void 0:S.current),e.currentTool=="editor"&&(I=e.stageRef)!==null&&I!==void 0&&I.current&&(e.stageRef.current.container().style.cursor="cell"),(Z=e.layerRef.current)===null||Z===void 0||Z.batchDraw()},onMouseOut:function(){var S;(S=e.stageRef)!==null&&S!==void 0&&S.current&&(e.stageRef.current.container().style.cursor="default")},x:s,y:u,radius:5/e.scale,fill:v})),s=void 0}),o.createElement(Se.ZA,{key:l.frontendId},o.createElement(Se.x1,{onMouseOver:function(){e.currentTool=="editor"&&(document.body.style.cursor="pointer")},onMouseOut:function(){document.body.style.cursor="default"},onClick:function(){e.currentTool=="editor"&&e.onSelect(l)},stroke:v,strokeWidth:2/e.scale,globalCompositeOperation:"source-over",lineCap:"round",points:t,tension:0,closed:n,fill:"rgba(".concat(d.r,", ").concat(d.g,", ").concat(d.b,", ").concat(c,")")}),i)}function Bn(e){var n=0;if(!e)return n;var a=(0,_.Z)(e),l;try{for(a.s();!(l=a.n()).done;){var t=l.value;!t||!t.frontendId||t.frontendId>n&&(n=t.frontendId)}}catch(v){a.e(v)}finally{a.f()}return n}function Tn(e){var n=function(c,s,i){var u,f,C=Mn((u=e.currentLabel)===null||u===void 0?void 0:u.color,[c,s]);!C||(console.log(C),e.onAnnotationAdd({dataId:e.dataId,type:"polygon",frontendId:(i==null?void 0:i.frontendId)!==void 0?i==null?void 0:i.frontendId:Bn(e.annotations)+1,label:e.currentLabel,labelId:(f=e.currentLabel)===null||f===void 0?void 0:f.labelId,result:C}))},a=function(c,s){var i;if(!(!e.currentAnnotation||!e.currentAnnotation.result||!((i=e.currentLabel)!==null&&i!==void 0&&i.color))){var u=e.currentAnnotation.result+",".concat(c,",").concat(s),f=(0,w.Z)((0,w.Z)({},e.currentAnnotation),{},{result:u});e.modifyAnnoByFrontendId(f)}},l=function(c){if(e.currentTool=="polygon"){var s=c.mouseX+c.offsetX,i=c.mouseY+c.offsetY;console.log("currentAnnotation:",e.currentAnnotation),e.currentAnnotation?a(s,i):n(s,i,e.selectFinly)}},t=function(c){console.log("param:",c)},v=function(){e.currentTool=="polygon"&&e.onMouseUp&&e.onMouseUp()};return{onMouseDown:l,onMouseMove:t,onMouseUp:v,drawAnnotation:Zn}}var Fn=h(10137),de=h(83721);function Ln(){this.TextColor="FFFFFF",this.Color="FF0000"}var Y={TotalColors:300,GetColor:function(){var n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,a=new Ln,l=n%Y.TotalColors,t=Y._CalColor(l);return a.Color=t.toString(16).padStart(6,"0"),a.TextColor=Y._CalTextColor(a.Color),a},_CalColor:function(){var n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,a=16711680,l=16777215,t=Y.TotalColors>0?Y.TotalColors:255,v=l/t;return n>=0&&n<=t&&(a=v*n),a=Math.round(a),a},_CalTextColor:function(){var n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"",a=n.substr(0,2),l=n.substr(2,2),t=n.substr(4,2),v=parseInt(a,16),d=parseInt(l,16),c=parseInt(t,16),s=kn(v,d,c);s.L=(s.L+.5)%1;var i=On(s.H,s.S,s.L),u=(i.R<<16)+(i.G<<8)+i.B;return u.toString(16).padStart(6,"0")}},kn=function(n,a,l){var t=n/255,v=a/255,d=l/255,c=Math.max(t,v,d),s=Math.min(t,v,d),i,u=(c+s)/2,f=(c+s)/2;if(c==s)i=u=0;else{var C=c-s;switch(u=f>.5?C/(2-c-s):C/(c+s),c){case t:i=(v-d)/C+(v<d?6:0);break;case v:i=(d-t)/C+2;break;case d:i=(t-v)/C+4;break}i/=6}return{H:i,S:u,L:f}},On=function(n,a,l){var t,v,d;if(a==0)t=v=d=l;else{var c=function(f,C,S){var I=S;return I<0&&(I+=1),I>1&&(I-=1),I<1/6?f+(C-f)*6*I:I<1/2?C:I<2/3?f+(C-f)*(2/3-I)*6:f},s=l<.5?l*(1+a):l+a-l*a,i=2*l-s;t=c(i,s,n+1/3),v=c(i,s,n),d=c(i,s,n-1/3)}return{R:Math.round(t*255),G:Math.round(v*255),B:Math.round(d*255)}},Ct=h(71194),Rn=h(48889),It=h(49111),zn=h(19650),yt=h(47673),Ce=h(74485),Pt=h(9715),Q=h(71257),Ie="http://127.0.0.1:1234",Dn=function(n){var a=Q.Z.useForm(),l=(0,O.Z)(a,1),t=l[0],v=(0,de.Ad)("component.PPInteractorModal"),d=n.model,c=n.project;(0,o.useEffect)(function(){var i,u,f,C;if(!!c.curr){var S=c.curr.otherSettings?c.curr.otherSettings:{},I={mlBackendUrl:S.mlBackendUrl,modelFilePath:(i=S.modelSettings)===null||i===void 0||(u=i.EISeg)===null||u===void 0?void 0:u.modelFilePath,paramFilePath:(f=S.modelSettings)===null||f===void 0||(C=f.EISeg)===null||C===void 0?void 0:C.paramFilePath};t.setFieldsValue(I),S.mlBackendUrl?d.setMlBackendUrl(S.mlBackendUrl):d.setMlBackendUrl(Ie),S.modelFilePath&&S.paramFilePath&&d.load("EISeg",S.modelFilePath,S.paramFilePath)}},[c.curr]);function s(i){var u,f,C,S,I,Z,F,E;console.log("saveMlsettings",c.curr,i),c.curr||q.default.error("Please select project first!"),c.curr.otherSettings||(c.curr.otherSettings={}),c.curr.otherSettings.mlBackendUrl=t.getFieldValue("mlBackendUrl"),c.curr.otherSettings.modelSettings={},c.curr.otherSettings.modelSettings.EISeg={},c.curr.otherSettings.modelSettings.EISeg.modelFilePath=t.getFieldValue("modelFilePath"),c.curr.otherSettings.modelSettings.EISeg.paramFilePath=t.getFieldValue("paramFilePath"),c.update(c.curr.projectId,{otherSettings:c.curr.otherSettings}),d.setMlBackendUrl(c.curr.otherSettings.mlBackendUrl),n.model.setLoading(!0),d.load("EISeg",(u=c.curr)===null||u===void 0||(f=u.otherSettings)===null||f===void 0||(C=f.models)===null||C===void 0||(S=C.EISeg)===null||S===void 0?void 0:S.modelFilePath,(I=c.curr)===null||I===void 0||(Z=I.otherSettings)===null||Z===void 0||(F=Z.models)===null||F===void 0||(E=F.EISeg)===null||E===void 0?void 0:E.paramFilePath).then(function(){q.default.info(v("modelLoaded")),n.model.setLoading(!1)},function(){n.model.setLoading(!1)})}return o.createElement(Rn.Z,{title:v("title"),visible:n.visible,onCancel:n.onCancel,footer:null,width:"60rem"},o.createElement(Q.Z,{form:t,name:"basic",labelCol:{span:8},wrapperCol:{span:16},onFinish:function(u){console.log("form finish",u),s(u),n.setVisible(!1)},autoComplete:"off"},o.createElement(Q.Z.Item,{name:"mlBackendUrl",label:v("mlBackendUrl"),labelCol:{span:6},wrapperCol:{span:18},initialValue:Ie,style:{fontSize:"1.5rem"}},o.createElement(Ce.Z,{autoComplete:"off",placeholder:Ie})),o.createElement(Q.Z.Item,{name:"modelFilePath",label:v("modelPath"),labelCol:{span:6},wrapperCol:{span:18},style:{fontSize:"1.5rem"}},o.createElement(Ce.Z,{autoComplete:"off",placeholder:v("pathPh")})),o.createElement(Q.Z.Item,{name:"paramFilePath",label:v("weightPath"),labelCol:{span:6},wrapperCol:{span:18},style:{fontSize:"1.5rem"}},o.createElement(Ce.Z,{autoComplete:"off",placeholder:v("pathPh")})),o.createElement(Q.Z.Item,{wrapperCol:{offset:8,span:16}},o.createElement(zn.Z,null,o.createElement(ie.Z,{onClick:function(){var u;(u=n.onCancel)===null||u===void 0||u.call(0)}},v("cancel","global")),o.createElement(ie.Z,{type:"primary",htmlType:"submit"},v("ok","global"))))),o.createElement("div",{style:{fontSize:"16px",color:"red"}},v("Warintoast")))},wn=Dn,Un=h(13237),je=h.n(Un),$n=function(n){var a=(0,de.Ad)("component.PPInteractorModal"),l=n.model,t=n.project,v=(0,o.useState)(!1),d=(0,O.Z)(v,2),c=d[0],s=d[1];return o.createElement(o.Fragment,null,o.createElement(Te.Z,{overlayClassName:"".concat(je().popover," ").concat(je().popoverLeft),placement:"left",content:o.createElement(ie.Z,{onClick:function(){return s(!0)},type:"primary",style:{height:"2.5rem"},block:!0},a("title")),trigger:"hover"}," ",o.createElement($.Z,{imgSrc:n.imgSrc||"",onClick:n.onClick,active:n.active},n.children)),o.createElement(wn,{visible:c,setVisible:s,model:l,project:t,onCancel:function(){s(!1)}}))},jn=$n,Ve=h(28271),Vn=function(){var n,a,l,t=(0,Le.I)("pages.toolBar"),v=(0,o.useState)(0),d=(0,O.Z)(v,2),c=d[0],s=d[1],i=(0,o.useState)(!(U.m8!==null&&U.m8!==void 0&&(n=U.m8.location)!==null&&n!==void 0&&n.pathname.includes("/instance_segmentation"))),u=(0,O.Z)(i,1),f=u[0],C=(0,o.useState)([]),S=(0,O.Z)(C,2),I=S[0],Z=S[1],F=(0,o.useState)(),E=(0,O.Z)(F,2),k=E[0],T=E[1],j=(0,o.useState)("label"),W=(0,O.Z)(j,2),V=W[0],oe=W[1],ye=(0,o.useState)(10),Ne=(0,O.Z)(ye,2),ce=Ne[0],xe=Ne[1],xn=(0,o.useState)(50),Xe=(0,O.Z)(xn,2),Pe=Xe[0],Xn=Xe[1],Wn=(0,o.useState)(),We=(0,O.Z)(Wn,2),se=We[0],Yn=We[1],Gn=(0,o.useState)(60),Ye=(0,O.Z)(Gn,2),Ae=Ye[0],Hn=Ye[1],Ge=(0,U.tT)("VisualRadius"),Jn=Ge.radius,Kn=Ge.setRadius,He=(0,U.tT)("InteractorData"),A=He.interactorData,Ee=He.setInteractorData,Qn=(0,o.useState)(!1),Je=(0,O.Z)(Qn,2),pn=Je[0],qn=Je[1],_n=(0,o.useState)(!1),Ke=(0,O.Z)(_n,2),Qe=Ke[0],et=Ke[1],nt=(0,o.useState)(!1),pe=(0,O.Z)(nt,2),tt=pe[0],ot=pe[1],re=(0,de.RZ)(o.useState),G=(0,o.useRef)(null),x=(0,de.$L)(o.useState,o.useEffect,{effectTrigger:{postTaskChange:function(r,b){H.init({annos:b})}},label:{oneHot:!0,postSelect:function(){g.setCurr(void 0),s(0)},preUnsetCurr:at},tool:{defaultTool:"mover"},task:{push:!0}}),B=x.tool,ve=x.loading,ae=x.scale,g=x.annotation,fe=x.task,N=x.data,p=x.project,z=x.label,rt=x.refreshVar,H=x.annHistory;function at(){g.setCurr(void 0),s(0)}var L=function(r){g.setCurr(r),r!=null&&r.frontendId?s(r.frontendId):s(0)},lt=function(){if(A.active){var r,b=(0,Ve.VL)(Pe,g.all,A==null?void 0:A.predictData,(r=N.curr)===null||r===void 0?void 0:r.dataId,I,k,z.curr);if(console.log("label.anno",b),b){var y,P=g.all.concat([b]);g.setAll(P),L(b),g.pushToBackend((y=N.curr)===null||y===void 0?void 0:y.dataId,P)}console.log("...interactorData",(0,w.Z)((0,w.Z)({},A),{},{active:!0,predictData:[]})),Ee({mousePoints:[],active:!0,predictData:[]}),qn(!0)}},qe=function(){var r;if(((r=g.all)===null||r===void 0?void 0:r.length)>0){var b=new Map,y=[];V!=="label"?g.all.forEach(function(P){var M=Y.GetColor(P.frontendId),R=JSON.parse(JSON.stringify(P));R.label.color="#"+M.Color,b.set(P.frontendId,R)}):g.all.forEach(function(P){console.log("debuggerannos",P),b.set(P.frontendId,P)}),b.forEach(function(P){y.push(P)}),console.log("items",y),Z(y),T(null)}else Z([]),T(null)};(0,o.useEffect)(function(){console.log("useEffect\u51FD\u6570\u6267\u884C\u4E86",g.all),qe()},[ve.curr,V,pn]),(0,o.useEffect)(function(){A.active&&A.predictData.length&&(console.log("interactorData",A),lt())},[Qe]),(0,o.useEffect)(function(){if(!ve.curr&&V!=="label"){var m=g.all.map(function(r){var b=Y.GetColor(r.frontendId),y=JSON.parse(JSON.stringify(r));return y.label.color="#"+b.Color,y});console.log("newAnnotation",m),Yn(m)}},[V,g.all,ve.curr]);var it=function(r){!r||(console.log("onAnnotationModify",r),g.all.pop(),g.all.push(r),L(r),g.setAll(g.all))},ut=function(r){var b=[],y=(0,_.Z)(g.all),P;try{for(y.s();!(P=y.n()).done;){var M=P.value;console.log("annotationUP:",M,r),M.frontendId==r.frontendId?b.push(r):b.push(M)}}catch(R){y.e(R)}finally{y.f()}L(r),g.setAll(b),g.update(r)},_e=function(r){console.log("modifyAnnoByFrontendId:",r);var b=[],y=(0,_.Z)(g.all),P;try{for(y.s();!(P=y.n()).done;){var M=P.value;M.frontendId==r.frontendId?b.push(r):b.push(M)}}catch(R){y.e(R)}finally{y.f()}L(r),g.setAll(b)},dt=function(r){var b;g.setAll(r),g.pushToBackend((b=N.curr)===null||b===void 0?void 0:b.dataId,r)},ge={dataId:(a=N.curr)===null||a===void 0?void 0:a.dataId,currentLabel:z.curr,brushSize:ce,scale:ae.curr,currentTool:B.curr,annotations:g.all,labels:z.all,currentAnnotation:g.curr,onAnnotationAdd:function(r){var b=g.all.concat([r]);g.setAll(b),L(r)},onAnnotationModify:it,modifyAnnoByFrontendId:_e,onMouseUp:function(){var r;A.active||(H.record({annos:g.all,currAnno:g.curr}),g.pushToBackend((r=N.curr)===null||r===void 0?void 0:r.dataId,g.all))},frontendIdOps:{frontendId:c,setFrontendId:s},model:re,finlyList:I,selectFinly:k,isLabel:V},ct={polygon:Tn(ge),brush:Sn(ge),interactor:(0,Ve.ZP)(ge),rubber:An(ge)};console.log("annotation.all",g.all);var st=function(r){console.log("selected ".concat(r)),oe(r)};return o.createElement(nn.Z,{className:"segment"},o.createElement(Be.Z,null,o.createElement($.Z,{imgSrc:"./pics/buttons/polygon.png",active:B.curr=="polygon",disabled:A.active,onClick:function(){if(!z.curr){q.default.error(t("chooseCategoryFirst"));return}B.setCurr("polygon"),L(void 0)}},t("polygon")),o.createElement($.Z,{active:B.curr=="editor",disabled:A.active,imgSrc:"./pics/buttons/edit.png",onClick:function(){B.setCurr("editor")}},t("edit")),o.createElement(ee.Z,{imgSrc:"./pics/buttons/brush.png",size:ce,active:B.curr=="brush",disabled:A.active,onClick:function(){if(!z.curr){q.default.error(t("chooseCategoryFirst"));return}B.curr!="rubber"&&B.curr!="brush"&&L(void 0),B.setCurr("brush")},onChange:function(r){r>=1&&xe(r)}},t("brush")),o.createElement(ee.Z,{size:ce,active:B.curr=="rubber",disabled:f&&A.active||!((l=g.all)!==null&&l!==void 0&&l.length),onClick:function(){B.curr!="rubber"&&B.curr!="brush"&&L(void 0),B.setCurr("rubber")},onChange:function(r){xe(r)},imgSrc:"./pics/buttons/rubber.png"},t("rubber")),o.createElement($.Z,{imgSrc:"./pics/buttons/zoom_in.png",onClick:function(){ae.change(.1)}},t("zoomIn")),o.createElement($.Z,{imgSrc:"./pics/buttons/zoom_out.png",onClick:function(){ae.change(-.1)}},t("zoomOut")),o.createElement($.Z,{imgSrc:"./pics/buttons/save.png",onClick:function(){var r;g.pushToBackend((r=N.curr)===null||r===void 0?void 0:r.dataId)},disabled:A.active},t("save")),o.createElement($.Z,{active:B.curr=="mover",imgSrc:"./pics/buttons/move.png",onClick:function(){B.curr=="mover"?A.active?B.setCurr("interactor"):B.setCurr(void 0):B.setCurr("mover")}},t("move")),o.createElement($.Z,{imgSrc:"./pics/buttons/prev.png",onClick:function(){H.backward().then(function(r){if(r){var b;g.setAll(r.annos),L(r.currAnno),g.pushToBackend((b=N.curr)===null||b===void 0?void 0:b.dataId,r.annos)}})},disabled:A.active},t("unDo")),o.createElement($.Z,{imgSrc:"./pics/buttons/next.png",onClick:function(){H.forward().then(function(r){if(r){var b;g.pushToBackend((b=N.curr)===null||b===void 0?void 0:b.dataId,r.annos),L(r.currAnno)}})},disabled:A.active},t("reDo")),o.createElement($.Z,{imgSrc:"./pics/buttons/clear_mark.png",onClick:function(){g.setCurr(void 0),g.clear(),H.record({annos:[]}),T(null),Z([]),B.setCurr(void 0),z.setCurr(void 0)},disabled:A.active},t("clearMark"))),o.createElement("div",{id:"dr",className:"mainStage"},o.createElement(en.Z,{tip:"loading",spinning:!!ve.curr},o.createElement("div",{className:"draw"},o.createElement(vn.Z,{ref:G,scale:ae.curr,taskIndex:fe.currIdx,scaleChange:ae.setScale,annotations:V=="label"?g.all:se||[],currentTool:B.curr,labels:z.all,tool:B,currentAnnotation:g.curr,currentLabel:z.curr,setCurrentAnnotation:L,onAnnotationModify:_e,onAnnotationModifyUP:ut,onAnnotationModifyComplete:function(){!A.active},onMousepoint:function(){et(!Qe)},onMousepoint2:function(){ot(!tt)},annotationDelete:dt,frontendIdOps:{frontendId:c,setFrontendId:s},imgSrc:N.imgSrc,transparency:Ae,threshold:Pe,onAnnotationAdd:function(r){var b=g.all.concat([r]);g.setAll(b),g.curr||L(r)},drawTool:ct,refresh:rt,brushSize:ce})),o.createElement("div",{className:"prevTask","data-test-id":"prevTask",onClick:function(){var r;!fe.prevTask()||(L(void 0),T(null),Z([]),G==null||(r=G.current)===null||r===void 0||r.setDragEndPos({x:0,y:0}))}}),o.createElement("div",{className:"nextTask","data-test-id":"nextTask",onClick:function(){var r;!fe.nextTask()||(L(void 0),T(null),Z([]),G==null||(r=G.current)===null||r===void 0||r.setDragEndPos({x:0,y:0}))}})),o.createElement("div",{className:"pblock"},o.createElement(Fn.Z,{task:fe,project:p}))),o.createElement(Be.Z,{disLoc:"right"},o.createElement($.Z,{imgSrc:"./pics/buttons/data_division.png",disabled:A.active,onClick:function(){U.m8.push("/project_overview?projectId=".concat(p.curr.projectId))}},t("projectOverview")),o.createElement(jn,{imgSrc:"./pics/buttons/intelligent_interaction.png",active:A.active,onClick:(0,me.Z)((0,K.Z)().mark(function m(){var r,b,y,P,M,R,X,J,Me;return(0,K.Z)().wrap(function(D){for(;;)switch(D.prev=D.next){case 0:if(console.log("model.loading",re.loading),!re.loading){D.next=4;break}return q.default.error(t("modelLoading")),D.abrupt("return");case 4:if(!A.active){D.next=9;break}B.setCurr(void 0),Ee({active:!1,predictData:[],mousePoints:[]}),D.next=21;break;case 9:return M=p.curr.otherSettings?p.curr.otherSettings:{},console.log("settings.modelSettings?.EISeg?.modelFilePath",M==null||(r=M.modelSettings)===null||r===void 0||(b=r.EISeg)===null||b===void 0?void 0:b.modelFilePath,M==null||(y=M.modelSettings)===null||y===void 0||(P=y.EISeg)===null||P===void 0?void 0:P.paramFilePath),D.prev=11,D.next=14,re.load("EISeg",M==null||(R=M.modelSettings)===null||R===void 0||(X=R.EISeg)===null||X===void 0?void 0:X.modelFilePath,M==null||(J=M.modelSettings)===null||J===void 0||(Me=J.EISeg)===null||Me===void 0?void 0:Me.paramFilePath);case 14:D.next=19;break;case 16:return D.prev=16,D.t0=D.catch(11),D.abrupt("return");case 19:B.setCurr("interactor"),Ee({active:!0,predictData:[],mousePoints:[]});case 21:case"end":return D.stop()}},m,null,[[11,16]])})),model:re,project:p},t("interactor")),o.createElement(ee.Z,{disabled:!A.active,imgSrc:"./pics/buttons/threshold.png",disLoc:"left",size:Pe,maxSize:100,minSize:10,step:10,onChange:function(r){Xn(r)}},t("segmentThreshold")),o.createElement(ee.Z,{disabled:!A.active,imgSrc:"./pics/buttons/radius.png",disLoc:"left",size:Jn,maxSize:50,minSize:5,step:5,onChange:function(r){Kn(r)}},t("visualRadius")),o.createElement(ee.Z,{imgSrc:"./pics/buttons/alpha.png",disLoc:"left",size:Ae,maxSize:100,minSize:0,disabled:A.active,onChange:function(r){Hn(r)}},t("transparency")),!f&&o.createElement(cn,{imgSrc:"./pics/buttons/alpha.png",disLoc:"left",size:Ae,maxSize:100,minSize:0,disabled:A.active,onChange:st},t("colorMode"))),o.createElement("div",{className:"rightSideBar"},!f&&o.createElement("div",{className:"determinOutline"},o.createElement(ie.Z,{disabled:f,style:{height:40,fontSize:"0.75rem"},type:"primary",block:!0,onClick:function(){qe()}},t("determineOutline"))),o.createElement(sn.Z,{hideColorPicker:!1,labels:z.all,activeIds:z.activeIds,onLabelSelect:z.onSelect,onLabelDelete:z.remove,onLabelAdd:function(r){z.create((0,w.Z)((0,w.Z)({},r),{},{projectId:p.curr.projectId})).then(function(b){L(void 0),z.setCurr(b)})}}),f?o.createElement(Re.Z,{currAnnotation:g.curr,annotations:V=="label"?g.all:se||[],onAnnotationSelect:function(r){r!=null&&r.delete||L(r)},onAnnotationAdd:function(){L(void 0)},onAnnotationModify:function(){},onAnnotationDelete:function(){var m=(0,me.Z)((0,K.Z)().mark(function r(b){var y,P;return(0,K.Z)().wrap(function(R){for(;;)switch(R.prev=R.next){case 0:return P=g.all.filter(function(X){return X.frontendId!=b.frontendId}),H.record({annos:P}),g.setAll(P),L(void 0),R.next=6,g.pushToBackend((y=N.curr)===null||y===void 0?void 0:y.dataId,P);case 6:case"end":return R.stop()}},r)}));return function(r){return m.apply(this,arguments)}}(),disabled:A.active}):o.createElement(Re.Z,{currAnnotation:k,annotations:I,onAnnotationSelect:function(r){r!=null&&r.delete||(console.log("selectedAnno",r),T(r))},onAnnotationAdd:function(){L(void 0)},onAnnotationModify:function(){},onAnnotationDelete:function(){var m=(0,me.Z)((0,K.Z)().mark(function r(b){var y,P,M;return(0,K.Z)().wrap(function(X){for(;;)switch(X.prev=X.next){case 0:return P=g.all.filter(function(J){return J.frontendId!=b.frontendId}),M=I.filter(function(J){return J.frontendId!=b.frontendId}),H.record({annos:P}),g.setAll(P),Z(M),L(void 0),X.next=8,g.pushToBackend((y=N.curr)===null||y===void 0?void 0:y.dataId,P);case 8:case"end":return X.stop()}},r)}));return function(r){return m.apply(this,arguments)}}(),disabled:A.active})))},Nn=Vn}}]);
