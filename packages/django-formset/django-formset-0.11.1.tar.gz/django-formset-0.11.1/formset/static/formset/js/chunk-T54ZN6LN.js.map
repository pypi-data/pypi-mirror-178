{
  "version": 3,
  "sources": ["../../../../client/django-formset/SortableSelect.ts"],
  "sourcesContent": ["import Sortable, { MultiDrag, SortableEvent } from 'sortablejs';\nimport { StyleHelpers } from './helpers';\nimport styles from './SortableSelect.scss';\n\nSortable.mount(new MultiDrag());\n\n\nexport class SortableSelectElement extends HTMLElement {\n\tprivate readonly declaredStyles: HTMLStyleElement;\n\tprivate lastSelected: HTMLOptionElement | null = null;\n\n\tpublic constructor() {\n\t\tsuper();\n\t\tthis.declaredStyles = document.createElement('style');\n\t\tthis.declaredStyles.innerText = styles;\n\t\tdocument.head.appendChild(this.declaredStyles);\n\n\t\tthis.addEventListener('click', event => this.optionSelected(event));\n\t\twindow.addEventListener('click', event => this.elementFocus(event));\n\t}\n\n\tpublic initialize(selectElement: HTMLSelectElement) {\n\t\tthis.transferStyles(selectElement);\n\t\tSortable.create(this, {\n\t\t\tanimation: 150,\n\t\t\tfallbackOnBody: true,\n\t\t\tmultiDrag: true,\n\t\t\tonEnd: event => this.onEnd(event),\n\t\t});\n\t}\n\n\tprivate onEnd(event: SortableEvent) {\n\t\tthis.deselectAllOptions();\n\t\tconst sortedEvent = new Event('options-sorted', {\n\t\t\tbubbles: true,\n\t\t\tcancelable: true,\n\t\t\tcomposed: false\n\t\t});\n\t\tthis.dispatchEvent(sortedEvent);\n\t}\n\n\tprivate elementFocus(event: Event) {\n\t\tif (event.target instanceof HTMLElement && this.contains(event.target)) {\n\t\t\tthis.classList.add('focus');\n\t\t} else {\n\t\t\tthis.classList.remove('focus');\n\t\t}\n\t}\n\n\tprivate optionSelected(event: Event) {\n\t\tif (!(event.target instanceof HTMLOptionElement))\n\t\t\treturn;\n\t\tconst selectedOption = event.target;\n\t\tif (event instanceof PointerEvent && event.metaKey) {\n\t\t\tif (selectedOption.selected = !selectedOption.selected) {\n\t\t\t\tSortable.utils.select(selectedOption);\n\t\t\t} else {\n\t\t\t\tSortable.utils.deselect(selectedOption);\n\t\t\t}\n\t\t} else if (event instanceof PointerEvent && event.shiftKey && this.lastSelected) {\n\t\t\tthis.deselectAllOptions();\n\t\t\tlet setSeleted = false;\n\t\t\tfor (let option of this.getElementsByTagName('option')) {\n\t\t\t\tif (option === selectedOption || option === this.lastSelected) {\n\t\t\t\t\toption.selected = true;\n\t\t\t\t\tsetSeleted = !setSeleted;\n\t\t\t\t} else {\n\t\t\t\t\toption.selected = setSeleted;\n\t\t\t\t}\n\t\t\t\tif (option.selected) {\n\t\t\t\t\tSortable.utils.select(option);\n\t\t\t\t}\n\t\t\t}\n\t\t} else {\n\t\t\tthis.deselectAllOptions();\n\t\t\tselectedOption.selected = true;\n\t\t\tSortable.utils.select(selectedOption);\n\t\t}\n\t\tthis.lastSelected = selectedOption;\n\t\tevent.preventDefault();\n\t}\n\n\tprivate deselectAllOptions() {\n\t\tfor (let option of this.getElementsByTagName('option')) {\n\t\t\toption.selected = false;\n\t\t\tSortable.utils.deselect(option);\n\t\t}\n\t}\n\n\tprivate transferStyles(selectElement: HTMLSelectElement) {\n\t\tconst sheet = this.declaredStyles.sheet;\n\t\tconst optionElement = selectElement.querySelector('option');\n\t\tfor (let index = 0; sheet && index < sheet.cssRules.length; index++) {\n\t\t\tconst cssRule = sheet.cssRules.item(index) as CSSStyleRule;\n\t\t\tlet extraStyles: string;\n\t\t\tswitch (cssRule.selectorText) {\n\t\t\t\tcase 'django-sortable-select':\n\t\t\t\t\textraStyles = StyleHelpers.extractStyles(selectElement, [\n\t\t\t\t\t\t'display', 'width', 'height', 'border', 'box-shadow', 'outline', 'overflow',\n\t\t\t\t\t\t'font-family', 'font-size', 'font-strech', 'font-style', 'font-weight',\n\t\t\t\t\t\t'letter-spacing', 'white-space', 'line-height']);\n\t\t\t\t\tsheet.insertRule(`${cssRule.selectorText}{${extraStyles}}`, ++index);\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'django-sortable-select.focus':\n\t\t\t\t\tselectElement.style.transition = 'none';\n\t\t\t\t\tselectElement.focus();\n\t\t\t\t\textraStyles = StyleHelpers.extractStyles(selectElement, [\n\t\t\t\t\t\t'border', 'box-shadow', 'outline']);\n\t\t\t\t\tselectElement.blur();\n\t\t\t\t\tsheet.insertRule(`${cssRule.selectorText}{${extraStyles}}`, ++index);\n\t\t\t\t\tselectElement.style.transition = '';\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'django-sortable-select > option.sortable-chosen, django-sortable-select > option.sortable-selected':\n\t\t\t\t\tif (optionElement) {\n\t\t\t\t\t\toptionElement.selected = true;\n\t\t\t\t\t\textraStyles = StyleHelpers.extractStyles(optionElement, [\n\t\t\t\t\t\t\t'color', 'background-color']);\n\t\t\t\t\t\tsheet.insertRule(`${cssRule.selectorText}{${extraStyles}}`, ++index);\n\t\t\t\t\t\toptionElement.selected = false;\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'django-sortable-select.focus > option.sortable-chosen, django-sortable-select.focus > option.sortable-selected':\n\t\t\t\t\tselectElement.focus();\n\t\t\t\t\tif (optionElement) {\n\t\t\t\t\t\toptionElement.selected = true;\n\t\t\t\t\t\textraStyles = StyleHelpers.extractStyles(optionElement, [\n\t\t\t\t\t\t\t'color', 'background-color']);\n\t\t\t\t\t\tsheet.insertRule(`${cssRule.selectorText}{${extraStyles}}`, ++index);\n\t\t\t\t\t\toptionElement.selected = false;\n\t\t\t\t\t}\n\t\t\t\t\tselectElement.blur();\n\t\t\t\t\tbreak;\n\t\t\t\tdefault:\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t}\n\n\tpublic add(option: HTMLOptionElement) {\n\t\tthis.appendChild(option);\n\t\tSortable.utils.select(option);\n\t}\n}\n"],
  "mappings": "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",
  "names": ["sortable_esm_default", "MultiDragPlugin", "SortableSelectElement", "SortableSelect_default", "event", "selectElement", "sortedEvent", "selectedOption", "setSeleted", "option", "sheet", "optionElement", "index", "cssRule", "extraStyles", "StyleHelpers"]
}
