import{a}from"./chunk-Z6FKEQLM.js";import{a as E}from"./chunk-Q73546RI.js";import{a as c}from"./chunk-T54ZN6LN.js";import"./chunk-SNXKFZ2Y.js";import"./chunk-XXGBPDQQ.js";import{b as f}from"./chunk-ON5OQYWL.js";var u=f(E()),h=class extends a{constructor(e,t){var o;super(e);this.historicalValues=[];this.historyCursor=0;this.selectorElement=e,this.containerElement=this.fieldGroup.querySelector(".dj-dual-selector"),e.setAttribute("multiple","multiple");let i=this.fieldGroup.querySelectorAll('input[type="text"]');i.length===2&&(this.searchLeftInput=i[0],this.searchRightInput=i[1],this.searchLeftInput.addEventListener("input",l=>this.leftLookup()),this.searchRightInput.addEventListener("input",l=>this.rightLookup()));let s=this.fieldGroup.querySelectorAll(`select:not([is="${t}"])`);if(s.length>=1)if(this.selectLeftElement=s.item(0),s.length===2)this.selectRightElement=s.item(1);else{let l=this.fieldGroup.querySelector("django-sortable-select");this.selectRightElement=l}else throw new Error(`<select is="${t}"> requires two <select>-elements`);this.moveAllRightButton=this.fieldGroup.querySelector("button.dj-move-all-right"),this.moveSelectedRightButton=this.fieldGroup.querySelector("button.dj-move-selected-right"),this.moveSelectedLeftButton=this.fieldGroup.querySelector("button.dj-move-selected-left"),this.moveAllLeftButton=this.fieldGroup.querySelector("button.dj-move-all-left"),this.undoButton=this.fieldGroup.querySelector("button.dj-undo-selected"),this.redoButton=this.fieldGroup.querySelector("button.dj-redo-selected"),this.selectorElement.classList.add("dj-concealed");let n=(o=e.parentElement)==null?void 0:o.querySelector("template.select-no-results");this.renderNoResults=l=>n?(0,u.default)(n.innerHTML)(l):"No results",this.installEventHandlers(),this.initialize(),this.setButtonsState()}installEventHandlers(){var e,t,i,s,n,o;this.selectLeftElement.addEventListener("focus",this.touch),this.selectLeftElement.addEventListener("dblclick",l=>this.moveOptionRight(l.target)),this.selectLeftElement.addEventListener("scroll",l=>this.selectLeftScrolled()),this.selectRightElement.addEventListener("focus",this.touch),this.selectRightElement.addEventListener("dblclick",l=>this.moveOptionLeft(l.target)),this.selectRightElement.addEventListener("options-sorted",l=>this.optionsSorted()),(e=this.moveAllRightButton)==null||e.addEventListener("click",l=>this.moveAllOptionsRight()),(t=this.moveSelectedRightButton)==null||t.addEventListener("click",l=>this.moveSelectedOptionsRight()),(i=this.moveSelectedLeftButton)==null||i.addEventListener("click",l=>this.moveSelectedOptionsLeft()),(s=this.moveAllLeftButton)==null||s.addEventListener("click",l=>this.moveAllOptionsLeft()),(n=this.undoButton)==null||n.addEventListener("click",l=>this.unOrRedo(-1)),(o=this.redoButton)==null||o.addEventListener("click",l=>this.unOrRedo(1))}getOptions(e){return Array.from(e.getElementsByTagName("option"))}initialize(){let e=[];for(let t of this.getOptions(this.selectorElement)){let i=t.cloneNode();t.selected?(t.selected=!1,this.selectRightElement.add(t),e.push(t.value)):this.selectLeftElement.add(t),this.selectorElement.add(i)}this.historicalValues.push(e),this.setHistoryCursor(0),this.selectRightElement instanceof c&&this.selectRightElement.initialize(this.selectLeftElement)}addNoResultsOption(e,t){let i=new Option(this.renderNoResults({input:t}));i.disabled=!0,e.add(i)}prepareOptions(e){let t=this.getOptions(e);return t.filter(i=>i.disabled).forEach(i=>i.remove()),t}addMoreOptions(e){let t=this.getOptions(this.selectorElement);for(let i of e)if(t.filter(s=>s.value==i.id).length===0){let s=new Option(i.label,i.id);this.selectorElement.add(s.cloneNode()),this.selectLeftElement.add(s)}}async selectLeftScrolled(){if(!this.isIncomplete)return;this.selectLeftElement.scrollHeight-this.selectLeftElement.scrollTop<=this.selectLeftElement.offsetHeight&&await this.remoteLookup()}async remoteLookup(){var i;let e,t=(i=this.searchLeftInput)==null?void 0:i.value;if(t){let s=this.getOptions(this.selectLeftElement).filter(n=>!n.hidden).length;e=`query=${t}&offset=${s}`}else e=`offset=${this.selectorElement.childElementCount}`;this.lastRemoteQuery!==e&&(this.lastRemoteQuery=e,await this.loadOptions(e,s=>{this.addMoreOptions(s)}))}selectorChanged(){var i;let e=this.getOptions(this.selectRightElement),t=this.getOptions(this.selectorElement);for(let s of t)s.selected=e.filter(n=>n.value===s.value).length===1;this.setButtonsState(),(i=this.containerElement)==null||i.classList.toggle("invalid",!this.selectorElement.checkValidity()),this.selectorElement.dispatchEvent(new Event("change"))}setButtonsState(){let e=this.getOptions(this.selectLeftElement).filter(t=>!t.hidden).length===0;this.moveAllRightButton.disabled=e,this.moveSelectedRightButton.disabled=e,e=this.getOptions(this.selectRightElement).filter(t=>!t.hidden).length===0,this.moveAllLeftButton.disabled=e,this.moveSelectedLeftButton.disabled=e}clearSearchFields(){this.searchLeftInput&&(this.searchLeftInput.value=""),this.searchRightInput&&(this.searchRightInput.value=""),this.prepareOptions(this.selectLeftElement).forEach(e=>e.hidden=!1),this.prepareOptions(this.selectRightElement).forEach(e=>e.hidden=!1)}optionsMoved(){let e=this.getOptions(this.selectRightElement);this.historicalValues.splice(this.historyCursor+1),this.historicalValues.push(e.map(t=>t.value)),this.setHistoryCursor(this.historicalValues.length-1),this.selectorChanged()}optionsSorted(){this.getOptions(this.selectorElement).filter(e=>e.selected).forEach(e=>e.remove()),this.getOptions(this.selectRightElement).forEach(e=>{let t=e.cloneNode();t.selected=!0,this.selectorElement.add(t)}),this.optionsMoved()}async moveOptionRight(e){e instanceof HTMLOptionElement&&(this.selectRightElement.add(e),await this.selectLeftScrolled(),this.optionsMoved())}async moveAllOptionsRight(){this.getOptions(this.selectLeftElement).filter(e=>!e.hidden).forEach(e=>this.selectRightElement.add(e)),this.clearSearchFields(),await this.selectLeftScrolled(),this.optionsMoved()}moveSelectedOptionsRight(){this.getOptions(this.selectLeftElement).filter(e=>e.selected).forEach(e=>this.selectRightElement.add(e)),this.optionsMoved()}moveSelectedOptionsLeft(){this.getOptions(this.selectRightElement).filter(e=>e.selected).forEach(e=>this.selectLeftElement.add(e)),this.optionsMoved()}moveAllOptionsLeft(){this.getOptions(this.selectRightElement).filter(e=>!e.hidden).forEach(e=>this.selectLeftElement.add(e)),this.clearSearchFields(),this.optionsMoved()}moveOptionLeft(e){e instanceof HTMLOptionElement&&(this.selectLeftElement.add(e),this.optionsMoved())}async leftLookup(){var i;let e=((i=this.searchLeftInput)==null?void 0:i.value)??"",t=this.lookup(this.prepareOptions(this.selectLeftElement),e);this.isIncomplete&&t<this.selectLeftElement.size&&(await this.remoteLookup(),t=this.lookup(this.getOptions(this.selectLeftElement),e)),this.setButtonsState(),t===0&&this.addNoResultsOption(this.selectLeftElement,e)}rightLookup(){var t;let e=((t=this.searchRightInput)==null?void 0:t.value)??"";this.lookup(this.prepareOptions(this.selectRightElement),e)===0&&this.addNoResultsOption(this.selectRightElement,e)}lookup(e,t){return t?(t=t.toLowerCase(),e.forEach(i=>i.hidden=i.text.toLowerCase().indexOf(t)===-1),e.length-e.filter(i=>i.hidden).length):(e.forEach(i=>i.hidden=!1),e.length)}unOrRedo(e){this.clearSearchFields();let t=this.historyCursor+e;if(t<0||t>=this.historicalValues.length)return;let i=this.historicalValues[t];this.getOptions(this.selectRightElement).filter(s=>i.indexOf(s.value)===-1).forEach(s=>this.selectLeftElement.add(s)),this.getOptions(this.selectLeftElement).filter(s=>i.indexOf(s.value)!==-1).forEach(s=>this.selectRightElement.add(s)),this.selectRightElement.tagName==="DJANGO-SORTABLE-SELECT"&&(i.forEach(s=>{let n=this.selectRightElement.querySelector(`option[value="${s}"]`);n&&this.selectRightElement.insertAdjacentElement("beforeend",n)}),this.optionsSorted()),this.setHistoryCursor(t),this.selectorChanged()}setHistoryCursor(e){this.historyCursor=e,this.undoButton&&(this.undoButton.disabled=e===0),this.redoButton&&(this.redoButton.disabled=e===this.historicalValues.length-1)}formResetted(e){var i;this.clearSearchFields();let t=this.historicalValues[0];this.historicalValues.splice(1),this.setHistoryCursor(0),this.getOptions(this.selectRightElement).filter(s=>t.indexOf(s.value)===-1).forEach(s=>this.selectLeftElement.add(s)),this.getOptions(this.selectLeftElement).filter(s=>t.indexOf(s.value)!==-1).forEach(s=>this.selectRightElement.add(s)),this.selectorChanged(),(i=this.containerElement)==null||i.classList.remove("invalid")}formSubmitted(e){this.clearSearchFields(),this.historicalValues.splice(0,this.historicalValues.length-1),this.setHistoryCursor(0)}getValue(){return this.getOptions(this.selectorElement).filter(e=>e.selected).map(e=>e.value)}},r=Symbol("DualSelectorElement"),d=class extends HTMLSelectElement{connectedCallback(){this[r]=new h(this,"django-dual-selector")}get value(){var e;return(e=this[r])==null?void 0:e.getValue()}};r;export{h as DualSelector,d as DualSelectorElement};
//# sourceMappingURL=DualSelector-HFTT6NUG.js.map
